<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://yoursite.com').hostname,
    root: '/',
    scheme: 'Mist',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="在任何一个web框架中，路由都是其最基础也是最核心的功能。Symfony 的路由功能十分强大且灵活，我们可以用它非常方便的创建一个美观的路由。今天我就基于 Symfony 的官方文档，完整地讲讲 Symfony 路由功能的使用。 什么是路由当我们的应用程序接收到一个请求后，就会执行一个控制器方法来创建响应信息。路由功能定义了通过哪一个具体的控制器方法，来响应不同URL的请求。形象的讲，路由就是一个">
<meta property="og:type" content="article">
<meta property="og:title" content="Symfony 5 基础之路由">
<meta property="og:url" content="http://yoursite.com/2020/07/25/Symfony-5-%E5%9F%BA%E7%A1%80%E4%B9%8B%E8%B7%AF%E7%94%B1/index.html">
<meta property="og:site_name" content="盐 碱 地">
<meta property="og:description" content="在任何一个web框架中，路由都是其最基础也是最核心的功能。Symfony 的路由功能十分强大且灵活，我们可以用它非常方便的创建一个美观的路由。今天我就基于 Symfony 的官方文档，完整地讲讲 Symfony 路由功能的使用。 什么是路由当我们的应用程序接收到一个请求后，就会执行一个控制器方法来创建响应信息。路由功能定义了通过哪一个具体的控制器方法，来响应不同URL的请求。形象的讲，路由就是一个">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-07-25T01:53:41.000Z">
<meta property="article:modified_time" content="2020-08-29T07:26:10.421Z">
<meta property="article:author" content="Andy Zhang">
<meta property="article:tag" content="PHP">
<meta property="article:tag" content="Symfony">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/2020/07/25/Symfony-5-%E5%9F%BA%E7%A1%80%E4%B9%8B%E8%B7%AF%E7%94%B1/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>Symfony 5 基础之路由 | 盐 碱 地</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0827f66baef0e8fc8bd5d7647e82136b";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">盐 碱 地</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/07/25/Symfony-5-%E5%9F%BA%E7%A1%80%E4%B9%8B%E8%B7%AF%E7%94%B1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Andy Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="盐 碱 地">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Symfony 5 基础之路由
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-25 09:53:41" itemprop="dateCreated datePublished" datetime="2020-07-25T09:53:41+08:00">2020-07-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-08-29 15:26:10" itemprop="dateModified" datetime="2020-08-29T15:26:10+08:00">2020-08-29</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>在任何一个web框架中，路由都是其最基础也是最核心的功能。Symfony 的路由功能十分强大且灵活，我们可以用它非常方便的创建一个美观的路由。今天我就基于 Symfony 的官方文档，完整地讲讲 Symfony 路由功能的使用。</p>
<h3 id="什么是路由"><a href="#什么是路由" class="headerlink" title="什么是路由"></a><span id="what_is_a_route">什么是路由</span></h3><p>当我们的应用程序接收到一个请求后，就会执行一个控制器方法来创建响应信息。路由功能定义了通过哪一个具体的控制器方法，来响应不同URL的请求。形象的讲，路由就是一个工头，负责把不同的任务，分配给不同岗位的工人完成。配置路由其实就是在配置工头的分配规则。当然，Symfony 允许我们在路由功能基础之上，做一些额外的事情，比如安全校验、路由美化等。</p>
<a id="more"></a>

<h3 id="创建路由"><a href="#创建路由" class="headerlink" title="创建路由"></a><span id="creating_routes">创建路由</span></h3><p>Symfony 的路由功能十分灵活，我们可以使用传的方式，在不同类型的文件中配置路由，如YAML, XML, PHP。也可以使用 annotations（注解路由）来定义一个路由。</p>
<h4 id="Annotations-方式创建路由"><a href="#Annotations-方式创建路由" class="headerlink" title="Annotations 方式创建路由"></a><span id="creating_routes_as_annotations">Annotations 方式创建路由</span></h4><p>在使用 annotations 前，需要在命令行安装 annotations 依赖：</p>
<p><code>composer require annotations</code></p>
<p>在安装完依赖后，执行的命令会创建一个新的配置文件：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/routes/annotations.yaml</span></span><br><span class="line"><span class="attr">controllers:</span></span><br><span class="line">    <span class="attr">resource:</span> <span class="string">'../../src/Controller/'</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">annotation</span></span><br><span class="line"></span><br><span class="line"><span class="attr">kernel:</span></span><br><span class="line">    <span class="attr">resource:</span> <span class="string">../../src/Kernel.php</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">annotation</span></span><br></pre></td></tr></table></figure>

<p>这个配置文件定义了 <code>src/Controller</code> 目录下的控制器，都可以使用 annotations 方式配置路由。</p>
<p>在 <code>src/Controller</code> 目录中创建一个新的PHP文件，并写入下面这些内容：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Bundle</span>\<span class="title">FrameworkBundle</span>\<span class="title">Controller</span>\<span class="title">AbstractController</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">HttpFoundation</span>\<span class="title">Response</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Annotation</span>\<span class="title">Route</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RouterFuncController</span> <span class="keyword">extends</span> <span class="title">AbstractController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment"># "/router"代表路由的URL routers_test代表路由名称 test()为路由所指向的控制器方法</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Route</span>("/router", name="routers_test")</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span><span class="params">()</span>: <span class="title">Response</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Response(</span><br><span class="line">            <span class="string">'&lt;html&gt;&lt;body&gt;This is router test.&lt;/body&gt;&lt;/html&gt;'</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在浏览器中打开 <code>http://symfony_dev.vm/router</code> 这个地址，就可以看到在Response中所写的内容了。</p>
<p>这个配置定义了一个名为 <code>routers_test</code> 的路由，当用户请求 <code>/router</code> URL时就会匹配到它。当匹配发生时，应用会调用 <code>RouterFuncController</code> 类中的 <code>test()</code> 方法。</p>
<blockquote>
<p>这个路由不仅仅会匹配 <code>http://symfony_dev.vm/router</code>，还会匹配 <code>http://symfony_dev.vm/router?foo=bar</code> 之类的URL。</p>
</blockquote>
<p>路由名 <code>routers_test</code> 现在还没有用到，但是当使用 <a href="#generating_urls">生成 URL</a> 功能时，它是必须的。一定要注意，每个路由的名称都必须是“唯一”的。</p>
<h4 id="以文件（YAML-XML-PHP）的方式创建路由"><a href="#以文件（YAML-XML-PHP）的方式创建路由" class="headerlink" title="以文件（YAML,XML,PHP）的方式创建路由"></a><span id="creating_routes_in_files">以文件（YAML,XML,PHP）的方式创建路由</span></h4><p>使用配置文件配置路由不需要安装任何依赖，直接配置对应格式的文件即可：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/routes.yaml</span></span><br><span class="line"><span class="comment"># routers_test为路由名称</span></span><br><span class="line"><span class="attr">routers_test:</span></span><br><span class="line">    <span class="comment"># /router为URL路径</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/router</span></span><br><span class="line">    <span class="comment"># controller值的格式为：控制器类名::方法名</span></span><br><span class="line">    <span class="attr">controller:</span> <span class="string">App\Controller\RouterFuncController::test</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- config/routes.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">routes</span> <span class="attr">xmlns</span>=<span class="string">"http://symfony.com/schema/routing"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://symfony.com/schema/routing</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://symfony.com/schema/routing/routing-1.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">route</span> <span class="attr">id</span>=<span class="string">"routers_test"</span> <span class="attr">path</span>=<span class="string">"/router"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">controller</span>=<span class="string">"App\Controller\RouterFuncController::test"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">routes</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/routes.php</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Controller</span>\<span class="title">RouterFuncController</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Loader</span>\<span class="title">Configurator</span>\<span class="title">RoutingConfigurator</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">(RoutingConfigurator $routes)</span> </span>&#123;</span><br><span class="line">    $routes-&gt;add(<span class="string">'routers_test'</span>, <span class="string">'/router'</span>)</span><br><span class="line">        -&gt;controller([RouterFuncController::class, <span class="string">'test'</span>])</span><br><span class="line">    ;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>可以看到，相对于用配置文件的方式配置路由，annotations 方式，明显更简洁一些。之前本人用过的一些框架都是在配置文件中配置路由，后来看到 Symfony 这种在注解中写路由的方式还感觉挺奇怪的。但是随着时间的推移，写的路由越来越多，就会发现 annotations 这种方式的优势：路由规则与控制器方法是一体的，所以不用专门写很多的配置文件。当需要对路由或方法的功能做修改，或是排查出现的 bug 时，不用在各种文件中跳来跳去，非常的方便。而且 annotations 还支持一些特有的功能，这些功能在某些场景下非常实用，后面会提到。</p>
<p>如果在使用 Symfony 时需要配置路由，个人推荐使用 annotations 这种方式。假如出于习惯，你仍然希望使用配置文件的方式配置路由，推荐优先使用 Symfony 推荐的配置文件格式：YAML。</p>
<p>之后的路由代码示例，默认都会包含 annotations、YAML、XML、PHP这四种方式（某些与定义路由无直接关系的配置将会不包含 annotations 方式），代码展示顺序也是依次的。</p>
<h4 id="匹配HTTP方法"><a href="#匹配HTTP方法" class="headerlink" title="匹配HTTP方法"></a><span id="matching_http_methods">匹配HTTP方法</span></h4><p>Symfony 默认的路由会匹配所有类型的方法，可以增加一个 <code>methods</code> 属性选项，对请求的方法做限制：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Controller/BlogApiController.php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BlogApiController</span> <span class="keyword">extends</span> <span class="title">AbstractController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Route</span>("/api/posts/&#123;id&#125;", methods=&#123;"GET","HEAD"&#125;)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">(int $id)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ... 以json格式返回一篇文章的详情</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Route</span>("/api/posts/&#123;id&#125;", methods=&#123;"PUT"&#125;)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">edit</span><span class="params">(int $id)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ... 编辑一篇文章的数据</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/routes.yaml</span></span><br><span class="line"><span class="attr">api_post_show:</span></span><br><span class="line">    <span class="attr">path:</span>       <span class="string">/api/posts/&#123;id&#125;</span></span><br><span class="line">    <span class="attr">controller:</span> <span class="string">App\Controller\BlogApiController::show</span></span><br><span class="line">    <span class="attr">methods:</span>    <span class="string">GET|HEAD</span></span><br><span class="line"></span><br><span class="line"><span class="attr">api_post_edit:</span></span><br><span class="line">    <span class="attr">path:</span>       <span class="string">/api/posts/&#123;id&#125;</span></span><br><span class="line">    <span class="attr">controller:</span> <span class="string">App\Controller\BlogApiController::edit</span></span><br><span class="line">    <span class="attr">methods:</span>    <span class="string">PUT</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- config/routes.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">routes</span> <span class="attr">xmlns</span>=<span class="string">"http://symfony.com/schema/routing"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://symfony.com/schema/routing</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://symfony.com/schema/routing/routing-1.0.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">route</span> <span class="attr">id</span>=<span class="string">"api_post_show"</span> <span class="attr">path</span>=<span class="string">"/api/posts/&#123;id&#125;"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">controller</span>=<span class="string">"App\Controller\BlogApiController::show"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">methods</span>=<span class="string">"GET|HEAD"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">route</span> <span class="attr">id</span>=<span class="string">"api_post_edit"</span> <span class="attr">path</span>=<span class="string">"/api/posts/&#123;id&#125;"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">controller</span>=<span class="string">"App\Controller\BlogApiController::edit"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">methods</span>=<span class="string">"PUT"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">routes</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/routes.php</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Controller</span>\<span class="title">BlogApiController</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Loader</span>\<span class="title">Configurator</span>\<span class="title">RoutingConfigurator</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">(RoutingConfigurator $routes)</span> </span>&#123;</span><br><span class="line">    $routes-&gt;add(<span class="string">'api_post_show'</span>, <span class="string">'/api/posts/&#123;id&#125;'</span>)</span><br><span class="line">        -&gt;controller([BlogApiController::class, <span class="string">'show'</span>])</span><br><span class="line">        -&gt;methods([<span class="string">'GET'</span>, <span class="string">'HEAD'</span>])</span><br><span class="line">    ;</span><br><span class="line">    $routes-&gt;add(<span class="string">'api_post_edit'</span>, <span class="string">'/api/posts/&#123;id&#125;'</span>)</span><br><span class="line">        -&gt;controller([BlogApiController::class, <span class="string">'edit'</span>])</span><br><span class="line">        -&gt;methods([<span class="string">'PUT'</span>])</span><br><span class="line">    ;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="匹配表达式"><a href="#匹配表达式" class="headerlink" title="匹配表达式"></a><span id="matching_expressions">匹配表达式</span></h4><p>也可以使用 <code>condition</code> 选项来实现一些任意匹配逻辑，比如匹配请求头中的 <code>User-Agent</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Controller/DefaultController.php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Bundle</span>\<span class="title">FrameworkBundle</span>\<span class="title">Controller</span>\<span class="title">AbstractController</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Annotation</span>\<span class="title">Route</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DefaultController</span> <span class="keyword">extends</span> <span class="title">AbstractController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Route</span>(</span></span><br><span class="line"><span class="comment">     *     "/contact",</span></span><br><span class="line"><span class="comment">     *     name="contact",</span></span><br><span class="line"><span class="comment">     *     condition="context.getMethod() in ['GET', 'HEAD'] and request.headers.get('User-Agent') matches '/firefox/i'"</span></span><br><span class="line"><span class="comment">     * )</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 表达式中也可以包含配置参数:</span></span><br><span class="line"><span class="comment">     * condition: "request.headers.get('User-Agent') 匹配 '%app.allowed_browsers%'"</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">contact</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/routes.yaml</span></span><br><span class="line"><span class="attr">contact:</span></span><br><span class="line">    <span class="attr">path:</span>       <span class="string">/contact</span></span><br><span class="line">    <span class="attr">controller:</span> <span class="string">'App\Controller\DefaultController::contact'</span></span><br><span class="line">    <span class="attr">condition:</span>  <span class="string">"context.getMethod() in ['GET', 'HEAD'] and request.headers.get('User-Agent') matches '/firefox/i'"</span></span><br><span class="line">    <span class="comment"># 表达式中也可以包含配置参数:</span></span><br><span class="line">    <span class="comment"># condition: "request.headers.get('User-Agent') 匹配 '%app.allowed_browsers%'"</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- config/routes.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">routes</span> <span class="attr">xmlns</span>=<span class="string">"http://symfony.com/schema/routing"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://symfony.com/schema/routing</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://symfony.com/schema/routing/routing-1.0.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">route</span> <span class="attr">id</span>=<span class="string">"contact"</span> <span class="attr">path</span>=<span class="string">"/contact"</span> <span class="attr">controller</span>=<span class="string">"App\Controller\DefaultController::contact"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">condition</span>&gt;</span>context.getMethod() in ['GET', 'HEAD'] and request.headers.get('User-Agent') matches '/firefox/i'<span class="tag">&lt;/<span class="name">condition</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 表达式中也可以包含配置参数: --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;condition&gt;request.headers.get('User-Agent') 匹配 '%app.allowed_browsers%'&lt;/condition&gt; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">route</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">routes</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/routes.php</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Controller</span>\<span class="title">DefaultController</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Loader</span>\<span class="title">Configurator</span>\<span class="title">RoutingConfigurator</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">(RoutingConfigurator $routes)</span> </span>&#123;</span><br><span class="line">    $routes-&gt;add(<span class="string">'contact'</span>, <span class="string">'/contact'</span>)</span><br><span class="line">        -&gt;controller([DefaultController::class, <span class="string">'contact'</span>])</span><br><span class="line">        -&gt;condition(<span class="string">'context.getMethod() in ["GET", "HEAD"] and request.headers.get("User-Agent") matches "/firefox/i"'</span>)</span><br><span class="line">        <span class="comment">// 表达式中也可以包含配置参数:</span></span><br><span class="line">        <span class="comment">// 'request.headers.get("User-Agent") 匹配 "%app.allowed_browsers%"'</span></span><br><span class="line">    ;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>context</code><br>  是 <code>Symfony\Component\Routing\RequestContext</code>的一个对象，它囊括了与路由匹配相关的大多数重要信息。</li>
<li><code>request</code><br>  <a href="https://symfony.com/doc/current/components/http_foundation.html#component-http-foundation-request" target="_blank" rel="noopener">Symfony Request</a> 对象代表当前请求。</li>
</ul>
<p>在应用真正运行的时候，这些表达式将会被编译成原生的PHP代码。所以不用担心使用 <code>condition</code> 后产生额外的时间开销。</p>
<blockquote>
<p>在使用创建URL功能的时候，<code>condition</code> 是无效的。</p>
</blockquote>
<h4 id="调试路由"><a href="#调试路由" class="headerlink" title="调试路由"></a><span id="debugging_routes">调试路由</span></h4><p>随着我们对应用开发维护工作的进行，应用中的路由也会越来越多。Symfony 提供了一些命令，以供调试路由使用。首先，<code>debug:router</code> 命令可以列出应用内的所有路由，顺序是 Symfony 评估它们的顺序：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt; php bin/console debug:router</span><br><span class="line"></span><br><span class="line">----------------  -------  -------  -----  --------------------------------------------</span><br><span class="line">Name              Method   Scheme   Host   Path</span><br><span class="line">----------------  -------  -------  -----  --------------------------------------------</span><br><span class="line">homepage          ANY      ANY      ANY    /</span><br><span class="line">contact           GET      ANY      ANY    /contact</span><br><span class="line">contact_process   POST     ANY      ANY    /contact</span><br><span class="line">article_show      ANY      ANY      ANY    /articles/&#123;_locale&#125;/&#123;year&#125;/&#123;title&#125;.&#123;_format&#125;</span><br><span class="line">blog              ANY      ANY      ANY    /blog/&#123;page&#125;</span><br><span class="line">blog_show         ANY      ANY      ANY    /blog/&#123;slug&#125;</span><br><span class="line">----------------  -------  -------  -----  --------------------------------------------</span><br></pre></td></tr></table></figure>

<p>传入路由的名称或是部分名称，可以打印出该路由的详情：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt; php bin/console debug:router app_lucky_number</span><br><span class="line"></span><br><span class="line">+-------------+---------------------------------------------------------+</span><br><span class="line">| Property    | Value                                                   |</span><br><span class="line">+-------------+---------------------------------------------------------+</span><br><span class="line">| Route Name  | app_lucky_number                                        |</span><br><span class="line">| Path        | /lucky/number/&#123;max&#125;                                     |</span><br><span class="line">| ...         | ...                                                     |</span><br><span class="line">| Options     | compiler_class: Symfony\Component\Routing\RouteCompiler |</span><br><span class="line">|             | utf8: <span class="literal">true</span>                                              |</span><br><span class="line">+-------------+---------------------------------------------------------+</span><br></pre></td></tr></table></figure>

<p>还有一个命令是 <code>router:match</code>，它能够显示匹配所给URL的路由。对于找出那些请求URL不能够匹配到我们所期望的控制器方法的路由，是非常有用的。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; php bin/console router:match /lucky/number/8</span><br><span class="line"></span><br><span class="line">  [OK] Route <span class="string">"app_lucky_number"</span> matches</span><br></pre></td></tr></table></figure>

<h3 id="路由参数"><a href="#路由参数" class="headerlink" title="路由参数"></a><span id="route_parameters">路由参数</span></h3><p>前面举的例子，使用的都是不可变的 <code>静态路由</code>。换句话说，就是定义了什么URL规则，就只能匹配什么样的URL规则。看起来好像没什么问题，但是在实际的开发过程中，我们经常需要某些路由中能够包含一些变量。比如说，就像我现在用的Hexo 搭建的博客，每篇文章的标题都是被包含在请求的URL中的。我们不可能为每一篇文章创建一个路由，这时候就需要创建一个动态路由（即路由中包含参数）来访问每一篇文章。</p>
<p>在Symfony 的路由中，变量要由一对大括号包裹起来，并且要有一个唯一名称。举个例子，一个显示博客文章的路由，就可以定义成 <code>/blog/{slug}</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Controller/BlogController.php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Bundle</span>\<span class="title">FrameworkBundle</span>\<span class="title">Controller</span>\<span class="title">AbstractController</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Annotation</span>\<span class="title">Route</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BlogController</span> <span class="keyword">extends</span> <span class="title">AbstractController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Route</span>("/blog/&#123;slug&#125;", name="blog_show")</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">(string $slug)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// $slug 能够匹配URL中动态的部分</span></span><br><span class="line">        <span class="comment">// 比如请求 /blog/yay-routing, 此时 $slug='yay-routing'</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/routes.yaml</span></span><br><span class="line"><span class="attr">blog_show:</span></span><br><span class="line">    <span class="attr">path:</span>       <span class="string">/blog/&#123;slug&#125;</span></span><br><span class="line">    <span class="attr">controller:</span> <span class="string">App\Controller\BlogController::show</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- config/routes.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">routes</span> <span class="attr">xmlns</span>=<span class="string">"http://symfony.com/schema/routing"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://symfony.com/schema/routing</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://symfony.com/schema/routing/routing-1.0.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">route</span> <span class="attr">id</span>=<span class="string">"blog_show"</span> <span class="attr">path</span>=<span class="string">"/blog/&#123;slug&#125;"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">controller</span>=<span class="string">"App\Controller\BlogController::show"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">routes</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/routes.php</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Controller</span>\<span class="title">BlogController</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Loader</span>\<span class="title">Configurator</span>\<span class="title">RoutingConfigurator</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">(RoutingConfigurator $routes)</span> </span>&#123;</span><br><span class="line">    $routes-&gt;add(<span class="string">'blog_show'</span>, <span class="string">'/blog/&#123;slug&#125;'</span>)</span><br><span class="line">        -&gt;controller([BlogController::class, <span class="string">'show'</span>])</span><br><span class="line">    ;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>变量部分（<code>{slug} 在这个例子中</code>）的名称被用来在路由存储和传递给控制器的地方，创建一个 PHP 变量。如果一个用户访问 <code>/blog/my-first-post</code> 这个 URL，Symfony 将会在 <code>BlogController</code> 类中执行 <code>show()</code> 方法，并且传递一个 <code>$slug = &#39;my-first-post</code> 参数到 <code>show()</code> 方法中。</p>
<p>路由可以定义任意数量的参数，但是它们中的每一个都只能在各自的路由中使用一次（例如 <code>/blog/posts-about-{category}/page/{pageNumber}</code>）。</p>
<h4 id="参数校验"><a href="#参数校验" class="headerlink" title="参数校验"></a><span id="parameters_validation">参数校验</span></h4><p>想象一下你的应用程序有一个 <code>blog_show</code> 路由（URL：<code>/blog/{slug}</code>）和一个 <code>blog_list</code> 路由（URL：<code>/blog/{page}</code>）。鉴于路由的参数可以接受任何值，就没有办法区分这两个路由。</p>
<p>如何用户访问了 <code>/blog/my-first-post</code>，两个路由都将会匹配并且 Symfony 会使用先被定义的那个路由。要解决这个问题，使用 <code>requirements</code> 选项给 <code>{page}</code> 参数添加一些校验规则：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Controller/BlogController.php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Bundle</span>\<span class="title">FrameworkBundle</span>\<span class="title">Controller</span>\<span class="title">AbstractController</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Annotation</span>\<span class="title">Route</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BlogController</span> <span class="keyword">extends</span> <span class="title">AbstractController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Route</span>("/blog/&#123;page&#125;", name="blog_list", requirements=&#123;"page"="\d+"&#125;)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">list</span><span class="params">(int $page)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Route</span>("/blog/&#123;slug&#125;", name="blog_show")</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">($slug)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/routes.yaml</span></span><br><span class="line"><span class="attr">blog_list:</span></span><br><span class="line">    <span class="attr">path:</span>       <span class="string">/blog/&#123;page&#125;</span></span><br><span class="line">    <span class="attr">controller:</span> <span class="string">App\Controller\BlogController::list</span></span><br><span class="line">    <span class="attr">requirements:</span></span><br><span class="line">        <span class="attr">page:</span> <span class="string">'\d+'</span></span><br><span class="line"></span><br><span class="line"><span class="attr">blog_show:</span></span><br><span class="line">    <span class="attr">path:</span>       <span class="string">/blog/&#123;slug&#125;</span></span><br><span class="line">    <span class="attr">controller:</span> <span class="string">App\Controller\BlogController::show</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- config/routes.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">routes</span> <span class="attr">xmlns</span>=<span class="string">"http://symfony.com/schema/routing"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://symfony.com/schema/routing</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://symfony.com/schema/routing/routing-1.0.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">route</span> <span class="attr">id</span>=<span class="string">"blog_list"</span> <span class="attr">path</span>=<span class="string">"/blog/&#123;page&#125;"</span> <span class="attr">controller</span>=<span class="string">"App\Controller\BlogController::list"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">requirement</span> <span class="attr">key</span>=<span class="string">"page"</span>&gt;</span>\d+<span class="tag">&lt;/<span class="name">requirement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">route</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">route</span> <span class="attr">id</span>=<span class="string">"blog_show"</span> <span class="attr">path</span>=<span class="string">"/blog/&#123;slug&#125;"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">controller</span>=<span class="string">"App\Controller\BlogController::show"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">routes</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/routes.php</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Controller</span>\<span class="title">BlogController</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Loader</span>\<span class="title">Configurator</span>\<span class="title">RoutingConfigurator</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">(RoutingConfigurator $routes)</span> </span>&#123;</span><br><span class="line">    $routes-&gt;add(<span class="string">'blog_list'</span>, <span class="string">'/blog/&#123;page&#125;'</span>)</span><br><span class="line">        -&gt;controller([BlogController::class, <span class="string">'list'</span>])</span><br><span class="line">        -&gt;requirements([<span class="string">'page'</span> =&gt; <span class="string">'\d+'</span>])</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">    $routes-&gt;add(<span class="string">'blog_show'</span>, <span class="string">'/blog/&#123;slug&#125;'</span>)</span><br><span class="line">        -&gt;controller([BlogController::class, <span class="string">'show'</span>])</span><br><span class="line">    ;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><code>requirements</code> 选项的定义使用了<a href="https://www.php.net/manual/zh/book.pcre.php" target="_blank" rel="noopener">PHP正则表达式</a>这种方式，路由的参数匹配对于匹配整个路由是必须的。在上面的例子中， <code>\d+</code> 在正则中表示匹配任意长度的<em>数字</em>。</p>
<table>
<thead>
<tr>
<th>URL</th>
<th>Route</th>
<th>Parameters</th>
</tr>
</thead>
<tbody><tr>
<td>/blog/2</td>
<td>blog_list</td>
<td>$page = 2</td>
</tr>
<tr>
<td>/blog/my-first-post</td>
<td>blog_show</td>
<td>$slug = my-first-post</td>
</tr>
</tbody></table>
<blockquote>
<p>路由的 <code>requirements</code> 选项中，也可以包含<a href="https://symfony.com/doc/current/configuration.html#configuration-parameters" target="_blank" rel="noopener">容器参数</a>。“容器参数”都是定义在配置文件中，在此期间可以一次性定义一些复杂的正则表达式内容，然后我们就可以在不同的路由中复用它。</p>
</blockquote>
<blockquote>
<p>参数也支持 <a href="https://www.php.net/manual/zh/regexp.reference.unicode.php" target="_blank" rel="noopener">PCRE Unicode字符属性</a>，能够匹配通用字符类型的转义序列。比如，<code>\p{Lu}</code> 可以匹配任意语言中所有的大写字符，<code>\p{Greek}</code> 可以匹配任意的希腊字符。</p>
</blockquote>
<blockquote>
<p>在路由参数中使用常规参数时，可以设置 <code>utf-8</code> 选项为 <code>true</code>， 然后就可以使用 <code>.</code> 字符匹配任意的 UTF-8 字符，而不只是单字节的字符。</p>
</blockquote>
<p>如果你愿意，也可以使用 <code>{参数名&lt;条件&gt;}</code> 这种语法，将各个参数变为内联样式。这个功能可以让配置更简洁，不过当条件比较复杂的时候，会降低路由的可读性。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Controller/BlogController.php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Bundle</span>\<span class="title">FrameworkBundle</span>\<span class="title">Controller</span>\<span class="title">AbstractController</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Annotation</span>\<span class="title">Route</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BlogController</span> <span class="keyword">extends</span> <span class="title">AbstractController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Route</span>("/blog/&#123;page&lt;\d+&gt;&#125;", name="blog_list")</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">list</span><span class="params">(int $page)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/routes.yaml</span></span><br><span class="line"><span class="attr">blog_list:</span></span><br><span class="line">    <span class="attr">path:</span>       <span class="string">/blog/&#123;page&lt;\d+&gt;&#125;</span></span><br><span class="line">    <span class="attr">controller:</span> <span class="string">App\Controller\BlogController::list</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- config/routes.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">routes</span> <span class="attr">xmlns</span>=<span class="string">"http://symfony.com/schema/routing"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://symfony.com/schema/routing</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://symfony.com/schema/routing/routing-1.0.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">route</span> <span class="attr">id</span>=<span class="string">"blog_list"</span> <span class="attr">path</span>=<span class="string">"/blog/&#123;page&lt;\d+&gt;&#125;"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">controller</span>=<span class="string">"App\Controller\BlogController::list"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ... --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">routes</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/routes.php</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Controller</span>\<span class="title">BlogController</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Loader</span>\<span class="title">Configurator</span>\<span class="title">RoutingConfigurator</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">(RoutingConfigurator $routes)</span> </span>&#123;</span><br><span class="line">    $routes-&gt;add(<span class="string">'blog_list'</span>, <span class="string">'/blog/&#123;page&lt;\d+&gt;&#125;'</span>)</span><br><span class="line">        -&gt;controller([BlogController::class, <span class="string">'list'</span>])</span><br><span class="line">    ;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="可选参数"><a href="#可选参数" class="headerlink" title="可选参数"></a><span id="optional_parameters">可选参数</span></h4><p>在前面的例子里，路由 <code>blog_list</code> 的匹配条件是 <code>/blog/{page}</code>。如果用户访问 <code>/blog/1</code>，路由可以匹配。但是如果它们访问了 <code>/blog</code>，路由就不会匹配到。因为一旦给路由添加了一个参数，这个参数就必须要有一个值。</p>
<p>我们可以通过给 <code>{page}</code> 参数添加一个默认值的方式，来让用户访问 <code>/blog</code> 时匹配到 <code>blog_list</code> 路由。当使用 annotations 时，默认值可以定义到控制器方法的参数中。在其他的配置格式中，需要将默认参数配置到 <code>dafault</code> 选项中。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Controller/BlogController.php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Bundle</span>\<span class="title">FrameworkBundle</span>\<span class="title">Controller</span>\<span class="title">AbstractController</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Annotation</span>\<span class="title">Route</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BlogController</span> <span class="keyword">extends</span> <span class="title">AbstractController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Route</span>("/blog/&#123;page&#125;", name="blog_list", requirements=&#123;"page"="\d+"&#125;)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">list</span><span class="params">(int $page = <span class="number">1</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/routes.yaml</span></span><br><span class="line"><span class="attr">blog_list:</span></span><br><span class="line">    <span class="attr">path:</span>       <span class="string">/blog/&#123;page&#125;</span></span><br><span class="line">    <span class="attr">controller:</span> <span class="string">App\Controller\BlogController::list</span></span><br><span class="line">    <span class="attr">defaults:</span></span><br><span class="line">        <span class="attr">page:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">requirements:</span></span><br><span class="line">        <span class="attr">page:</span> <span class="string">'\d+'</span></span><br><span class="line"></span><br><span class="line"><span class="attr">blog_show:</span></span><br><span class="line">    <span class="comment"># ...</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- config/routes.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">routes</span> <span class="attr">xmlns</span>=<span class="string">"http://symfony.com/schema/routing"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://symfony.com/schema/routing</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://symfony.com/schema/routing/routing-1.0.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">route</span> <span class="attr">id</span>=<span class="string">"blog_list"</span> <span class="attr">path</span>=<span class="string">"/blog/&#123;page&#125;"</span> <span class="attr">controller</span>=<span class="string">"App\Controller\BlogController::list"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span> <span class="attr">key</span>=<span class="string">"page"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">requirement</span> <span class="attr">key</span>=<span class="string">"page"</span>&gt;</span>\d+<span class="tag">&lt;/<span class="name">requirement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">route</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ... --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">routes</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/routes.php</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Controller</span>\<span class="title">BlogController</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Loader</span>\<span class="title">Configurator</span>\<span class="title">RoutingConfigurator</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">(RoutingConfigurator $routes)</span> </span>&#123;</span><br><span class="line">    $routes-&gt;add(<span class="string">'blog_list'</span>, <span class="string">'/blog/&#123;page&#125;'</span>)</span><br><span class="line">        -&gt;controller([BlogController::class, <span class="string">'list'</span>])</span><br><span class="line">        -&gt;defaults([<span class="string">'page'</span> =&gt; <span class="number">1</span>])</span><br><span class="line">        -&gt;requirements([<span class="string">'page'</span> =&gt; <span class="string">'\d+'</span>])</span><br><span class="line">    ;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>现在当用户访问 <code>/blog</code>时，<code>blog_list</code> 路由也能够匹配到，并且此时 <code>$page</code> 为默认值1。</p>
<blockquote>
<p>我们也可以使用多个可选参数，例如 <code>/blog/{slug}/{page}</code>，但是可选参数之后的所有内容都必须是可选的。例如，<code>/{page}/blog</code> 是一个合法路径，但是 <code>page</code> 参数将会是必须的（<code>/blog</code> 就不会匹配这个路由）。</p>
</blockquote>
<p>如果要在生成的 URL 中始终包含一些默认值（例如，强制生成 <code>/blog/1</code> 而不是上一示例中的 <code>/blog</code>），需要在参数名称钱添加 <code>!</code> 字符：<code>/blog/{!page}</code></p>
<p>在条件中，还可以使用语法 <code>{参数名&lt;条件&gt;}</code> 让每个参数中使用内联默认值。这个功能与内联条件是兼容的，所以可以在一个参数中内联这两个功能：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Controller/BlogController.php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Bundle</span>\<span class="title">FrameworkBundle</span>\<span class="title">Controller</span>\<span class="title">AbstractController</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Annotation</span>\<span class="title">Route</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BlogController</span> <span class="keyword">extends</span> <span class="title">AbstractController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Route</span>("/blog/&#123;page&lt;\d+&gt;?1&#125;", name="blog_list")</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">list</span><span class="params">(int $page)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/routes.yaml</span></span><br><span class="line"><span class="attr">blog_list:</span></span><br><span class="line">    <span class="attr">path:</span>       <span class="string">/blog/&#123;page&lt;\d+&gt;?1&#125;</span></span><br><span class="line">    <span class="attr">controller:</span> <span class="string">App\Controller\BlogController::list</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- config/routes.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">routes</span> <span class="attr">xmlns</span>=<span class="string">"http://symfony.com/schema/routing"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://symfony.com/schema/routing</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://symfony.com/schema/routing/routing-1.0.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">route</span> <span class="attr">id</span>=<span class="string">"blog_list"</span> <span class="attr">path</span>=<span class="string">"/blog/&#123;page&lt;\d+&gt;?1&#125;"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">controller</span>=<span class="string">"App\Controller\BlogController::list"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ... --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">routes</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/routes.php</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Controller</span>\<span class="title">BlogController</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Loader</span>\<span class="title">Configurator</span>\<span class="title">RoutingConfigurator</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">(RoutingConfigurator $routes)</span> </span>&#123;</span><br><span class="line">    $routes-&gt;add(<span class="string">'blog_list'</span>, <span class="string">'/blog/&#123;page&lt;\d+&gt;?1&#125;'</span>)</span><br><span class="line">        -&gt;controller([BlogController::class, <span class="string">'list'</span>])</span><br><span class="line">    ;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果想用 <code>null</code> 作为默认值，就在 <code>?</code> 字符后什么都不加（例如 <code>/blog/{page?}</code>）。</p>
</blockquote>
<h4 id="优先级参数"><a href="#优先级参数" class="headerlink" title="优先级参数"></a><span id="priority_parameter">优先级参数</span></h4><blockquote>
<p><code>priority</code> 参数在 Symfony 5.1 中首次被引入。</p>
</blockquote>
<p>当我们定义一个可以匹配许多路由的贪婪模式后，很可能在同类路由集合的一开始就匹配到，然后阻止了在此之后定义的任何同类路由被匹配。增加一个 <code>priority</code> 选项参数可以让我们选择路由的顺序，不过这个功能只在使用 annotations 方式时可用。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Controller/BlogController.php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Bundle</span>\<span class="title">FrameworkBundle</span>\<span class="title">Controller</span>\<span class="title">AbstractController</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Annotation</span>\<span class="title">Route</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BlogController</span> <span class="keyword">extends</span> <span class="title">AbstractController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 这个路由使用了贪婪模式，并且被首先定义了。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Route</span>("/blog/&#123;slug&#125;", name="blog_show")</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">(string $slug)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 如果不定义一个比0更高的优先级，这个路由就不能被访问到。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Route</span>("/blog/list", name="blog_list", priority=2)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">list</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置优先级参数需要使用一个整型值。更高优先级的路由比优先级低的路由匹配序列更高。如果优先级参数没有定义，那么默认值为0。</p>
<h4 id="参数转换"><a href="#参数转换" class="headerlink" title="参数转换"></a><span id="parameter_conversion">参数转换</span></h4><p>我们经常会遇到这样一种场景：将一个普通路由中的参数转换成另一种类型的值（例如，将一个标识用户的ID转换成用户对象）。Symfony 提供了这种叫做“参数转换”的功能，并且这个功能仍然只在使用 annotations<br>时可用。</p>
<p>将前一个路由配置中控制器方法的参数变一下，将 <code>string $slug</code> 变为 <code>BlogPost $post</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Controller/BlogController.php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Entity</span>\<span class="title">BlogPost</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Bundle</span>\<span class="title">FrameworkBundle</span>\<span class="title">Controller</span>\<span class="title">AbstractController</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Annotation</span>\<span class="title">Route</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BlogController</span> <span class="keyword">extends</span> <span class="title">AbstractController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Route</span>("/blog/&#123;slug&#125;", name="blog_show")</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">(BlogPost $post)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// $post is the object whose slug matches the routing parameter</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果控制器参数中包含了对象类型（此例中的 <code>BlogPost</code>）的类型约束，“参数转换”功能就会利用请求参数（此例中的 <code>slug</code>），发出一个数据库请求来查询这个参数代表的对象。如果找不到对象，Symfony 会自动创建一个 404 响应。怎么样，是不是感到非常的方便与智能。</p>
<p>想要知道更多的转换功能以及如何配置它们，可以阅读完整的<a href="https://symfony.com/doc/current/bundles/SensioFrameworkExtraBundle/annotations/converters.html" target="_blank" rel="noopener">参数转换文档</a>。</p>
<h4 id="特殊参数"><a href="#特殊参数" class="headerlink" title="特殊参数"></a><span id="special_parameters">特殊参数</span></h4><p>除了我们自己定义的参数，路由中还包含一些 Symfony 创建的特殊参数：</p>
<ul>
<li><p><code>_controller</code><br>  这个参数决定了当一个路由被匹配到时执行哪个控制器和方法。</p>
</li>
<li><p><code>_format</code><br>  匹配的值用于设置 <code>Request</code> 对象的“请求格式”。用来做设置响应的 <code>Content-Type</code>（例如，<code>json</code> 格式转换为 <code>application/json</code> 类型的<code>Content-Type</code>）之类的事情。</p>
</li>
<li><p><code>_fragment</code><br>  用于设置片段标识符，这是 URL 的最后一部分，是以 <code>#</code> 字符开头并且用于标识文档的一部分（其实就是html的锚点）。</p>
</li>
<li><p><code>_locale</code><br>  用于设置请求的<a href="https://symfony.com/doc/current/translation/locale.html#translation-locale-url" target="_blank" rel="noopener">locale</a>信息。</p>
</li>
</ul>
<p>我们可以在一个路由导入的地方引入这些属性（除了 <code>_fragment</code>）。Symfony 定义了一些使用同样名称的特殊属性（没有前导下划线），以便你更方便的定义它们：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Controller/ArticleController.php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArticleController</span> <span class="keyword">extends</span> <span class="title">AbstractController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Route</span>(</span></span><br><span class="line"><span class="comment">     *     "/articles/&#123;_locale&#125;/search.&#123;_format&#125;",</span></span><br><span class="line"><span class="comment">     *     locale="en",</span></span><br><span class="line"><span class="comment">     *     format="html",</span></span><br><span class="line"><span class="comment">     *     requirements=&#123;</span></span><br><span class="line"><span class="comment">     *         "_locale": "en|fr",</span></span><br><span class="line"><span class="comment">     *         "_format": "html|xml",</span></span><br><span class="line"><span class="comment">     *     &#125;</span></span><br><span class="line"><span class="comment">     * )</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">search</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/routes.yaml</span></span><br><span class="line"><span class="attr">article_search:</span></span><br><span class="line">  <span class="attr">path:</span>        <span class="string">/articles/&#123;_locale&#125;/search.&#123;_format&#125;</span></span><br><span class="line">  <span class="attr">controller:</span>  <span class="string">App\Controller\ArticleController::search</span></span><br><span class="line">  <span class="attr">locale:</span>      <span class="string">en</span></span><br><span class="line">  <span class="attr">format:</span>      <span class="string">html</span></span><br><span class="line">  <span class="attr">requirements:</span></span><br><span class="line">      <span class="attr">_locale:</span> <span class="string">en|fr</span></span><br><span class="line">      <span class="attr">_format:</span> <span class="string">html|xml</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- config/routes.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">routes</span> <span class="attr">xmlns</span>=<span class="string">"http://symfony.com/schema/routing"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://symfony.com/schema/routing</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://symfony.com/schema/routing/routing-1.0.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">route</span> <span class="attr">id</span>=<span class="string">"article_search"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">path</span>=<span class="string">"/articles/&#123;_locale&#125;/search.&#123;_format&#125;"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">controller</span>=<span class="string">"App\Controller\ArticleController::search"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">locale</span>=<span class="string">"en"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">format</span>=<span class="string">"html"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">requirement</span> <span class="attr">key</span>=<span class="string">"_locale"</span>&gt;</span>en|fr<span class="tag">&lt;/<span class="name">requirement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">requirement</span> <span class="attr">key</span>=<span class="string">"_format"</span>&gt;</span>html|rss<span class="tag">&lt;/<span class="name">requirement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">route</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">routes</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/routes.php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Loader</span>\<span class="title">Configurator</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Controller</span>\<span class="title">ArticleController</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">(RoutingConfigurator $routes)</span> </span>&#123;</span><br><span class="line">    $routes-&gt;add(<span class="string">'article_show'</span>, <span class="string">'/articles/&#123;_locale&#125;/search.&#123;_format&#125;'</span>)</span><br><span class="line">        -&gt;controller([ArticleController::class, <span class="string">'search'</span>])</span><br><span class="line">        -&gt;locale(<span class="string">'en'</span>)</span><br><span class="line">        -&gt;format(<span class="string">'html'</span>)</span><br><span class="line">        -&gt;requirements([</span><br><span class="line">            <span class="string">'_locale'</span> =&gt; <span class="string">'en|fr'</span>,</span><br><span class="line">            <span class="string">'_format'</span> =&gt; <span class="string">'html|rss'</span>,</span><br><span class="line">        ])</span><br><span class="line">    ;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="额外参数"><a href="#额外参数" class="headerlink" title="额外参数"></a><span id="extra_parameters">额外参数</span></h4><p>我们可以在路由的 <code>defaults</code> 选项中定义一些不在路由配置中的参数。这可以用来给路由所在的控制器传递额外的参数。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Controller/BlogController.php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Annotation</span>\<span class="title">Route</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BlogController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Route</span>("/blog/&#123;page&#125;", name="blog_index", defaults=&#123;"page": 1, "title": "Hello world!"&#125;)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">(int $page, string $title)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/routes.yaml</span></span><br><span class="line"><span class="attr">blog_index:</span></span><br><span class="line">    <span class="attr">path:</span>       <span class="string">/blog/&#123;page&#125;</span></span><br><span class="line">    <span class="attr">controller:</span> <span class="string">App\Controller\BlogController::index</span></span><br><span class="line">    <span class="attr">defaults:</span></span><br><span class="line">        <span class="attr">page:</span> <span class="number">1</span></span><br><span class="line">        <span class="attr">title:</span> <span class="string">"Hello world!"</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- config/routes.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">routes</span> <span class="attr">xmlns</span>=<span class="string">"http://symfony.com/schema/routing"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://symfony.com/schema/routing</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://symfony.com/schema/routing/routing-1.0.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">route</span> <span class="attr">id</span>=<span class="string">"blog_index"</span> <span class="attr">path</span>=<span class="string">"/blog/&#123;page&#125;"</span> <span class="attr">controller</span>=<span class="string">"App\Controller\BlogController::index"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span> <span class="attr">key</span>=<span class="string">"page"</span>&gt;</span>1<span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span> <span class="attr">key</span>=<span class="string">"title"</span>&gt;</span>Hello world!<span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">route</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">routes</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/routes.php</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Controller</span>\<span class="title">BlogController</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Loader</span>\<span class="title">Configurator</span>\<span class="title">RoutingConfigurator</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">(RoutingConfigurator $routes)</span> </span>&#123;</span><br><span class="line">    $routes-&gt;add(<span class="string">'blog_index'</span>, <span class="string">'/blog/&#123;page&#125;'</span>)</span><br><span class="line">        -&gt;controller([BlogController::class, <span class="string">'index'</span>])</span><br><span class="line">        -&gt;defaults([</span><br><span class="line">            <span class="string">'page'</span>  =&gt; <span class="number">1</span>,</span><br><span class="line">            <span class="string">'title'</span> =&gt; <span class="string">'Hello world!'</span>,</span><br><span class="line">        ])</span><br><span class="line">    ;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="路由参数中的斜线字符"><a href="#路由参数中的斜线字符" class="headerlink" title="路由参数中的斜线字符"></a><span id="slash_characters_in_route_parameters">路由参数中的斜线字符</span></h4><p>路由参数中可以包含除 <code>/</code> 斜线字符外的所有字符，因为斜线字符一般用来将 URL 分割成不同的部分。例如，如果 <code>/share/{token}</code> 路由中的 <code>token</code> 值包含一个 <code>/</code> 字符，这个路由就不会匹配。</p>
<p>一个可行的解决方案就是修改参数条件，来接受更多可能的字符。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Controller/DefaultController.php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Annotation</span>\<span class="title">Route</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DefaultController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Route</span>("/share/&#123;token&#125;", name="share", requirements=&#123;"token"=".+"&#125;)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">share</span><span class="params">($token)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/routes.yaml</span></span><br><span class="line"><span class="attr">share:</span></span><br><span class="line">    <span class="attr">path:</span>       <span class="string">/share/&#123;token&#125;</span></span><br><span class="line">    <span class="attr">controller:</span> <span class="string">App\Controller\DefaultController::share</span></span><br><span class="line">    <span class="attr">requirements:</span></span><br><span class="line">        <span class="attr">token:</span> <span class="string">.+</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- config/routes.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">routes</span> <span class="attr">xmlns</span>=<span class="string">"http://symfony.com/schema/routing"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://symfony.com/schema/routing</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://symfony.com/schema/routing/routing-1.0.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">route</span> <span class="attr">id</span>=<span class="string">"share"</span> <span class="attr">path</span>=<span class="string">"/share/&#123;token&#125;"</span> <span class="attr">controller</span>=<span class="string">"App\Controller\DefaultController::share"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">requirement</span> <span class="attr">key</span>=<span class="string">"token"</span>&gt;</span>.+<span class="tag">&lt;/<span class="name">requirement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">route</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">routes</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/routes.php</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Controller</span>\<span class="title">DefaultController</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Loader</span>\<span class="title">Configurator</span>\<span class="title">RoutingConfigurator</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">(RoutingConfigurator $routes)</span> </span>&#123;</span><br><span class="line">    $routes-&gt;add(<span class="string">'share'</span>, <span class="string">'/share/&#123;token&#125;'</span>)</span><br><span class="line">        -&gt;controller([DefaultController::class, <span class="string">'share'</span>])</span><br><span class="line">        -&gt;requirements([</span><br><span class="line">            <span class="string">'token'</span> =&gt; <span class="string">'.+'</span>,</span><br><span class="line">        ])</span><br><span class="line">    ;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果路由定义了多个参数，并且将这些“宽容”正则表达式应用于所有参数，你很可能得到不期待的结果。例如，如果你定义的路由是 <code>/share/{path}/{token}</code> 并且 <code>path</code> 和 <code>token</code> 都接受 <code>/</code>。<code>token</code> 将会只能获取到最后的路径，并且其余的部分会被第一个参数（<code>path</code>）所匹配。</p>
</blockquote>
<blockquote>
<p>如果路由中包含了特殊的 <code>{_format}</code> 参数，你就不应该在允许斜线的参数中使用 <code>.+</code> 条件。例如，如果匹配模式为 <code>/share/{token}.{_format}</code> 并且 <code>{token}</code> 允许任意字符， <code>/share/foo/bar.json</code> 这个URL将会把 <code>foo/bar.json</code>作为 <code>token</code>，而 <code>format</code> 将会是空的。要解决这个问题，可以通过将条件从 <code>.+</code> 替换为 <code>[^.]+</code> 来允许除 <code>.</code> 以外的字符。</p>
</blockquote>
<h3 id="路由组和前缀"><a href="#路由组和前缀" class="headerlink" title="路由组和前缀"></a><span id="route_groups_and_prefixes">路由组和前缀</span></h3><p>我们通常会让一组路由共享一些选项（例如所有的关于文章的路由都应该以 <code>/blog</code> 开头），这就是为什么 Symfony 会有一个共享路由配置的功能。</p>
<p>在使用 annotations 方式定义路由时，把通用配置放到控制器类的 <code>@Route</code> 注释中。其他的路由格式，在输入路由的选项定义通用配置。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Controller/BlogController.php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Annotation</span>\<span class="title">Route</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Route</span>("/blog", requirements=&#123;"_locale": "en|es|fr"&#125;, name="blog_")</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BlogController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Route</span>("/&#123;_locale&#125;", name="index")</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Route</span>("/&#123;_locale&#125;/posts/&#123;slug&#125;", name="show")</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">(Post $post)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/routes/annotations.yaml</span></span><br><span class="line"><span class="attr">controllers:</span></span><br><span class="line">    <span class="attr">resource:</span> <span class="string">'../../src/Controller/'</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">annotation</span></span><br><span class="line">    <span class="comment"># 这个配置会将 '/blog' 添加到到所有输入路由 URL 的开头</span></span><br><span class="line">    <span class="attr">prefix:</span> <span class="string">'/blog'</span></span><br><span class="line">    <span class="comment"># 这个配置会将 'blog_' 添加到所有输入路由名称的开头</span></span><br><span class="line">    <span class="attr">name_prefix:</span> <span class="string">'blog_'</span></span><br><span class="line">    <span class="comment"># 这些条件会添加到所有的输入路由</span></span><br><span class="line">    <span class="attr">requirements:</span></span><br><span class="line">        <span class="attr">_locale:</span> <span class="string">'en|es|fr'</span></span><br><span class="line">    <span class="comment"># 一个空 URL 的输入路由会变成 "/blog/"</span></span><br><span class="line">    <span class="comment"># 注释这个选项将会使用取消尾随斜线的 "/blog" 代替它</span></span><br><span class="line">    <span class="comment"># trailing_slash_on_root: false</span></span><br><span class="line">    <span class="comment"># 在使用 annotations 的时候 需要排除的文件或子目录</span></span><br><span class="line">    <span class="comment"># exclude: '../../src/Controller/&#123;DebugEmailController&#125;.php'</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- config/routes/annotations.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">routes</span> <span class="attr">xmlns</span>=<span class="string">"http://symfony.com/schema/routing"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://symfony.com/schema/routing</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://symfony.com/schema/routing/routing-1.0.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        'prefix' 将会被添加到所有输入路由 URL 的开头</span></span><br><span class="line"><span class="comment">        'name-prefix' 将会被添加到所有输入路由名称的开头</span></span><br><span class="line"><span class="comment">        'exclude' 定义了当加载 annotations 时排除的文件和子目录</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">"../../src/Controller/"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">type</span>=<span class="string">"annotation"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">prefix</span>=<span class="string">"/blog"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">name-prefix</span>=<span class="string">"blog_"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">exclude</span>=<span class="string">"../../src/Controller/&#123;DebugEmailController&#125;.php"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 这些条件会被添加到所有的输入路由中 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">requirement</span> <span class="attr">key</span>=<span class="string">"_locale"</span>&gt;</span>en|es|fr<span class="tag">&lt;/<span class="name">requirement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">import</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 一个空 URL 的输入路由会是 "/blog/"</span></span><br><span class="line"><span class="comment">         注释这个选项将会用 URL "/blog" 代替 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">"../../src/Controller/"</span> <span class="attr">type</span>=<span class="string">"annotation"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">prefix</span>=<span class="string">"/blog"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">trailing-slash-on-root</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- ... --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">import</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">routes</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/routes/annotations.php</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Loader</span>\<span class="title">Configurator</span>\<span class="title">RoutingConfigurator</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">(RoutingConfigurator $routes)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 使用 import() 方法的第五个参数 来定义在使用 annotations 时需要</span></span><br><span class="line">    <span class="comment">// 排除的文件和子目录</span></span><br><span class="line">    $routes-&gt;import(<span class="string">'../../src/Controller/'</span>, <span class="string">'annotation'</span>)</span><br><span class="line">        <span class="comment">// this is added to the beginning of all imported route URLs</span></span><br><span class="line">        -&gt;prefix(<span class="string">'/blog'</span>)</span><br><span class="line">        <span class="comment">// 一个空 URL 的输入路由会是 "/blog/"</span></span><br><span class="line">        <span class="comment">// 传递 FALSE 作为第二个参数将会用 URL "/blog" 替代它</span></span><br><span class="line">        <span class="comment">// -&gt;prefix('/blog', false)</span></span><br><span class="line">        <span class="comment">// 这个前缀将会添加到所有输入路由的开头</span></span><br><span class="line">        -&gt;namePrefix(<span class="string">'blog_'</span>)</span><br><span class="line">        <span class="comment">// 这些条件将会添加到所有的输入路由中</span></span><br><span class="line">        -&gt;requirements([<span class="string">'_locale'</span> =&gt; <span class="string">'en|es|fr'</span>])</span><br><span class="line">    ;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>在这个例子当中，<code>index()</code> 方法的路由名称将会被定义为 <code>blog_index</code>，并且它的 URL 将会是 <code>/blog</code>。<code>show()</code> 方法的路由名称会被定义为 <code>blog_show</code>，并且它的 URL 会是 <code>/blog/{_locale}/posts/{slug}</code>。这两个路由都会包含定义在类注释中匹配正则表达式的 <code>_locale</code> 参数。</p>
<p><em>Symfony 从<a href="https://symfony.com/doc/current/routing/custom_route_loader.htmlppp" target="_blank" rel="noopener">不同的来源</a>加载路由，你甚至可以自己创建一个路由的加载器。</em></p>
<h3 id="获取路由名称和参数"><a href="#获取路由名称和参数" class="headerlink" title="获取路由名称和参数"></a><span id="getting_the_route_name_and_parameters">获取路由名称和参数</span></h3><p>Symfony 创建的 <code>Request</code> 对象会在 “请求属性” 中储存所有的路由配置（例如名称和参数）。你可以在一个控制器中，通过 <code>Request</code> 对象获取到这些信息：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Controller/BlogController.php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Bundle</span>\<span class="title">FrameworkBundle</span>\<span class="title">Controller</span>\<span class="title">AbstractController</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">HttpFoundation</span>\<span class="title">Request</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Annotation</span>\<span class="title">Route</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BlogController</span> <span class="keyword">extends</span> <span class="title">AbstractController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Route</span>("/blog", name="blog_list")</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">list</span><span class="params">(Request $request)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">        $routeName = $request-&gt;attributes-&gt;get(<span class="string">'_route'</span>);</span><br><span class="line">        $routeParameters = $request-&gt;attributes-&gt;get(<span class="string">'_route_params'</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用下面的方法就可以获取到所有的可用属性 (不仅仅是路由信息):</span></span><br><span class="line">        $allAttributes = $request-&gt;attributes-&gt;all();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>你可以通过注入 <code>request_stack</code> 服务，从而<a href="https://symfony.com/doc/current/service_container/request.html" target="_blank" rel="noopener">在一个服务中获取 <code>Request</code> 对象</a>，然后就能在服务中获取到这些信息。在模板中，使用<a href="https://symfony.com/doc/current/templates.html#twig-app-variable" target="_blank" rel="noopener">Twig 全局应用变量</a>来获取请求和它的属性：</p>
<figure class="highlight twig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="keyword">set</span></span> route_name = app.request.attributes.get('_route') %&#125;</span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="keyword">set</span></span> route_parameters = app.request.attributes.get('_route_params') %&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&#123;# use this to get all the available attributes (not only routing ones) #&#125;</span></span><br><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="keyword">set</span></span> all_attributes = app.request.attributes.all %&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="特殊路由"><a href="#特殊路由" class="headerlink" title="特殊路由"></a><span id="special_routes">特殊路由</span></h3><p>Symfony 定义了一些特殊控制器，用来渲染模板和重定向到路由配置的其他路由，所以你不必创建一个控制器方法。</p>
<h4 id="直接从一个路由渲染模板"><a href="#直接从一个路由渲染模板" class="headerlink" title="直接从一个路由渲染模板"></a><span id="rendering_a_template_directly_from_a_route">直接从一个路由渲染模板</span></h4><p>在有关 Symfony 模板的主文章中，阅读关于<a href="https://symfony.com/doc/current/templates.html#templates-render-from-route" target="_blank" rel="noopener">从一个路由渲染模板</a>的章节。</p>
<h4 id="直接从一个路由重定向到-URL-和路由"><a href="#直接从一个路由重定向到-URL-和路由" class="headerlink" title="直接从一个路由重定向到 URL 和路由"></a><span id="redirecting_to_urls_and_routes_directly_from_a_route">直接从一个路由重定向到 URL 和路由</span></h4><p>使用 <code>RedirectController</code> 来重定向到其他的路由和 URL：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/routes.yaml</span></span><br><span class="line"><span class="attr">doc_shortcut:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/doc</span></span><br><span class="line">    <span class="attr">controller:</span> <span class="string">Symfony\Bundle\FrameworkBundle\Controller\RedirectController</span></span><br><span class="line">    <span class="attr">defaults:</span></span><br><span class="line">        <span class="attr">route:</span> <span class="string">'doc_page'</span></span><br><span class="line">        <span class="comment"># 你可以选择定义一些参数传递到路由中</span></span><br><span class="line">        <span class="attr">page:</span> <span class="string">'index'</span></span><br><span class="line">        <span class="attr">version:</span> <span class="string">'current'</span></span><br><span class="line">        <span class="comment"># 默认情况下，重定向是暂时的 (code 302) 但是你也可以让它们永久化 (code 301)</span></span><br><span class="line">        <span class="attr">permanent:</span> <span class="literal">true</span></span><br><span class="line">        <span class="comment"># 添加这个配置，可以让重定向时，保持原查询字符串参数</span></span><br><span class="line">        <span class="attr">keepQueryParams:</span> <span class="literal">true</span></span><br><span class="line">        <span class="comment"># 添加这个配置，来让当重定向时，保持请求的 HTTTP 方法。重定向的状态将会发生改变</span></span><br><span class="line">        <span class="comment"># * 对于临时重定向，将会用 307 状态码代替 302</span></span><br><span class="line">        <span class="comment"># * 对于永久重定向，将会用 308 状态码代替 301</span></span><br><span class="line">        <span class="attr">keepRequestMethod:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">legacy_doc:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/legacy/doc</span></span><br><span class="line">    <span class="attr">controller:</span> <span class="string">Symfony\Bundle\FrameworkBundle\Controller\RedirectController</span></span><br><span class="line">    <span class="attr">defaults:</span></span><br><span class="line">        <span class="comment"># 这个值可以是一个绝对路径或是绝对 URL</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">'https://legacy.example.com/doc'</span></span><br><span class="line">        <span class="attr">permanent:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- config/routes.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">routes</span> <span class="attr">xmlns</span>=<span class="string">"http://symfony.com/schema/routing"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://symfony.com/schema/routing</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://symfony.com/schema/routing/routing-1.0.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">route</span> <span class="attr">id</span>=<span class="string">"doc_shortcut"</span> <span class="attr">path</span>=<span class="string">"/doc"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">controller</span>=<span class="string">"Symfony\Bundle\FrameworkBundle\Controller\RedirectController"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span> <span class="attr">key</span>=<span class="string">"route"</span>&gt;</span>doc_page<span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 你可以选择定义一些参数传递到路由中 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span> <span class="attr">key</span>=<span class="string">"page"</span>&gt;</span>index<span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span> <span class="attr">key</span>=<span class="string">"version"</span>&gt;</span>current<span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 默认情况下，重定向是暂时的 (code 302) 但是你也可以让它们永久化 (code 301)--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span> <span class="attr">key</span>=<span class="string">"permanent"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 添加这个配置，可以让重定向时，保持原查询字符串参数 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span> <span class="attr">key</span>=<span class="string">"keepQueryParams"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 添加这个配置，来让当重定向时，保持请求的 HTTTP 方法。重定向的状态将会发生改变：</span></span><br><span class="line"><span class="comment">             * 对于临时重定向，将会用 307 状态码代替 302</span></span><br><span class="line"><span class="comment">             * 对于永久重定向，将会用 308 状态码代替 301 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span> <span class="attr">key</span>=<span class="string">"keepRequestMethod"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">route</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">route</span> <span class="attr">id</span>=<span class="string">"legacy_doc"</span> <span class="attr">path</span>=<span class="string">"/legacy/doc"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">controller</span>=<span class="string">"Symfony\Bundle\FrameworkBundle\Controller\RedirectController"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 这个值可以是一个绝对路径或是绝对 URL --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span> <span class="attr">key</span>=<span class="string">"path"</span>&gt;</span>https://legacy.example.com/doc<span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 默认情况下，重定向是暂时的 (code 302) 但是你也可以让它们永久化 (code 301)--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span> <span class="attr">key</span>=<span class="string">"permanent"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">route</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">routes</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/routes.php</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Controller</span>\<span class="title">DefaultController</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Bundle</span>\<span class="title">FrameworkBundle</span>\<span class="title">Controller</span>\<span class="title">RedirectController</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Loader</span>\<span class="title">Configurator</span>\<span class="title">RoutingConfigurator</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">(RoutingConfigurator $routes)</span> </span>&#123;</span><br><span class="line">    $routes-&gt;add(<span class="string">'doc_shortcut'</span>, <span class="string">'/doc'</span>)</span><br><span class="line">        -&gt;controller(RedirectController::class)</span><br><span class="line">         -&gt;defaults([</span><br><span class="line">            <span class="string">'route'</span> =&gt; <span class="string">'doc_page'</span>,</span><br><span class="line">            <span class="comment">// 你可以选择定义一些参数传递到路由中</span></span><br><span class="line">            <span class="string">'page'</span> =&gt; <span class="string">'index'</span>,</span><br><span class="line">            <span class="string">'version'</span> =&gt; <span class="string">'current'</span>,</span><br><span class="line">            <span class="comment">// 默认情况下，重定向是暂时的 (code 302) 但是你也可以让它们永久化 (code 301)</span></span><br><span class="line">            <span class="string">'permanent'</span> =&gt; <span class="keyword">true</span>,</span><br><span class="line">            <span class="comment">// 添加这个配置，可以让重定向时，保持原查询字符串参数</span></span><br><span class="line">            <span class="string">'keepQueryParams'</span> =&gt; <span class="keyword">true</span>,</span><br><span class="line">            <span class="comment">// 添加这个配置，来让当重定向时，保持请求的 HTTTP 方法。重定向的状态将会发生改变：</span></span><br><span class="line">            <span class="comment">// * 对于临时重定向，将会用 307 状态码代替 302</span></span><br><span class="line">            <span class="comment">// * 对于永久重定向，将会用 308 状态码代替 301</span></span><br><span class="line">            <span class="string">'keepRequestMethod'</span> =&gt; <span class="keyword">true</span>,</span><br><span class="line">        ])</span><br><span class="line">    ;</span><br><span class="line"></span><br><span class="line">    $routes-&gt;add(<span class="string">'legacy_doc'</span>, <span class="string">'/legacy/doc'</span>)</span><br><span class="line">        -&gt;controller(RedirectController::class)</span><br><span class="line">         -&gt;defaults([</span><br><span class="line">            <span class="comment">// 这个值可以是一个绝对路径或是绝对 URL</span></span><br><span class="line">            <span class="string">'path'</span> =&gt; <span class="string">'https://legacy.example.com/doc'</span>,</span><br><span class="line">            <span class="comment">// 默认情况下，重定向是暂时的 (code 302) 但是你也可以让它们永久化 (code 301)</span></span><br><span class="line">            <span class="string">'permanent'</span> =&gt; <span class="keyword">true</span>,</span><br><span class="line">        ])</span><br><span class="line">    ;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Symfony 也提供了一些公共工具来实现<a href="https://symfony.com/doc/current/controller.html#controller-redirect" target="_blank" rel="noopener">控制器内的重定向</a></p>
</blockquote>
<h4 id="使用拖尾斜杠重定向"><a href="#使用拖尾斜杠重定向" class="headerlink" title="使用拖尾斜杠重定向"></a><span id="redirecting_urls_with_trailing_slashes">使用拖尾斜杠重定向</span></h4><p>从历史上看，URL 遵循 UNIX 约定，即为目录添加拖尾斜杠（例如 <code>https://example.com/foo/</code>），并且删除它们以引入文件（<code>https://example.com/foo</code>）。尽管为这两个 URL 提供不同的内容是可以的，但是现在我们一般将它们视作同样的 URL 并在它们之间做重定向。</p>
<p>Symfony 遵循了这个逻辑，在具有拖尾斜杠的 URL 之间重定向（但只限 GET 和 HEAD 请求）：</p>
<table>
<thead>
<tr>
<th>Route URL</th>
<th>如果请求的 URL 是 /foo</th>
<th>如果请求的 URL 是 /foo/</th>
</tr>
</thead>
<tbody><tr>
<td>/foo</td>
<td>匹配 (200 状态响应)</td>
<td>做一个 301 重定向到 /foo</td>
</tr>
<tr>
<td>/foo/</td>
<td>做一个 301 重定向到 /foo/</td>
<td>匹配 (200 状态响应)</td>
</tr>
</tbody></table>
<h3 id="子域名路由"><a href="#子域名路由" class="headerlink" title="子域名路由"></a><span id="sub-domain_routing">子域名路由</span></h3><p>路由可以配置一个 <code>host</code> 选项来要求访问请求的 HTTP 主机匹配一些特定的值。在接下来的例子里，两个域名匹配同样的路径（<code>/</code>），但只有它们中的一个会为特殊的主机域名做出响应：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Controller/MainController.php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Bundle</span>\<span class="title">FrameworkBundle</span>\<span class="title">Controller</span>\<span class="title">AbstractController</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Annotation</span>\<span class="title">Route</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainController</span> <span class="keyword">extends</span> <span class="title">AbstractController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Route</span>("/", name="mobile_homepage", host="m.example.com")</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">mobileHomepage</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Route</span>("/", name="homepage")</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">homepage</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/routes.yaml</span></span><br><span class="line"><span class="attr">mobile_homepage:</span></span><br><span class="line">    <span class="attr">path:</span>       <span class="string">/</span></span><br><span class="line">    <span class="attr">host:</span>       <span class="string">m.example.com</span></span><br><span class="line">    <span class="attr">controller:</span> <span class="string">App\Controller\MainController::mobileHomepage</span></span><br><span class="line"></span><br><span class="line"><span class="attr">homepage:</span></span><br><span class="line">    <span class="attr">path:</span>       <span class="string">/</span></span><br><span class="line">    <span class="attr">controller:</span> <span class="string">App\Controller\MainController::homepage</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- config/routes.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">routes</span> <span class="attr">xmlns</span>=<span class="string">"http://symfony.com/schema/routing"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://symfony.com/schema/routing</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://symfony.com/schema/routing/routing-1.0.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">route</span> <span class="attr">id</span>=<span class="string">"mobile_homepage"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">path</span>=<span class="string">"/"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">host</span>=<span class="string">"m.example.com"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">controller</span>=<span class="string">"App\Controller\MainController::mobileHomepage"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">route</span> <span class="attr">id</span>=<span class="string">"homepage"</span> <span class="attr">path</span>=<span class="string">"/"</span> <span class="attr">controller</span>=<span class="string">"App\Controller\MainController::homepage"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">routes</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/routes.php</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Controller</span>\<span class="title">MainController</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Loader</span>\<span class="title">Configurator</span>\<span class="title">RoutingConfigurator</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">(RoutingConfigurator $routes)</span> </span>&#123;</span><br><span class="line">    $routes-&gt;add(<span class="string">'mobile_homepage'</span>, <span class="string">'/'</span>)</span><br><span class="line">        -&gt;controller([MainController::class, <span class="string">'mobileHomepage'</span>])</span><br><span class="line">        -&gt;host(<span class="string">'m.example.com'</span>)</span><br><span class="line">    ;</span><br><span class="line">    $routes-&gt;add(<span class="string">'homepage'</span>, <span class="string">'/'</span>)</span><br><span class="line">        -&gt;controller([MainController::class, <span class="string">'homepage'</span>])</span><br><span class="line">    ;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><code>host</code> 选项的值可以包含参数（对于多租户应用程序很有用）并且这些参数可以使用 <code>requirements</code> 做校验：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Controller/MainController.php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Bundle</span>\<span class="title">FrameworkBundle</span>\<span class="title">Controller</span>\<span class="title">AbstractController</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Annotation</span>\<span class="title">Route</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainController</span> <span class="keyword">extends</span> <span class="title">AbstractController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Route</span>(</span></span><br><span class="line"><span class="comment">     *     "/",</span></span><br><span class="line"><span class="comment">     *     name="mobile_homepage",</span></span><br><span class="line"><span class="comment">     *     host="&#123;subdomain&#125;.example.com",</span></span><br><span class="line"><span class="comment">     *     defaults=&#123;"subdomain"="m"&#125;,</span></span><br><span class="line"><span class="comment">     *     requirements=&#123;"subdomain"="m|mobile"&#125;</span></span><br><span class="line"><span class="comment">     * )</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">mobileHomepage</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Route</span>("/", name="homepage")</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">homepage</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/routes.yaml</span></span><br><span class="line"><span class="attr">mobile_homepage:</span></span><br><span class="line">    <span class="attr">path:</span>       <span class="string">/</span></span><br><span class="line">    <span class="attr">host:</span>       <span class="string">"&#123;subdomain&#125;.example.com"</span></span><br><span class="line">    <span class="attr">controller:</span> <span class="string">App\Controller\MainController::mobileHomepage</span></span><br><span class="line">    <span class="attr">defaults:</span></span><br><span class="line">        <span class="attr">subdomain:</span> <span class="string">m</span></span><br><span class="line">    <span class="attr">requirements:</span></span><br><span class="line">        <span class="attr">subdomain:</span> <span class="string">m|mobile</span></span><br><span class="line"></span><br><span class="line"><span class="attr">homepage:</span></span><br><span class="line">    <span class="attr">path:</span>       <span class="string">/</span></span><br><span class="line">    <span class="attr">controller:</span> <span class="string">App\Controller\MainController::homepage</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- config/routes.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">routes</span> <span class="attr">xmlns</span>=<span class="string">"http://symfony.com/schema/routing"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://symfony.com/schema/routing</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://symfony.com/schema/routing/routing-1.0.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">route</span> <span class="attr">id</span>=<span class="string">"mobile_homepage"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">path</span>=<span class="string">"/"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">host</span>=<span class="string">"&#123;subdomain&#125;.example.com"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">controller</span>=<span class="string">"App\Controller\MainController::mobileHomepage"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span> <span class="attr">key</span>=<span class="string">"subdomain"</span>&gt;</span>m<span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">requirement</span> <span class="attr">key</span>=<span class="string">"subdomain"</span>&gt;</span>m|mobile<span class="tag">&lt;/<span class="name">requirement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">route</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">route</span> <span class="attr">id</span>=<span class="string">"homepage"</span> <span class="attr">path</span>=<span class="string">"/"</span> <span class="attr">controller</span>=<span class="string">"App\Controller\MainController::homepage"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">routes</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/routes.php</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Controller</span>\<span class="title">MainController</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Loader</span>\<span class="title">Configurator</span>\<span class="title">RoutingConfigurator</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">(RoutingConfigurator $routes)</span> </span>&#123;</span><br><span class="line">    $routes-&gt;add(<span class="string">'mobile_homepage'</span>, <span class="string">'/'</span>)</span><br><span class="line">        -&gt;controller([MainController::class, <span class="string">'mobileHomepage'</span>])</span><br><span class="line">        -&gt;host(<span class="string">'&#123;subdomain&#125;.example.com'</span>)</span><br><span class="line">        -&gt;defaults([</span><br><span class="line">            <span class="string">'subdomain'</span> =&gt; <span class="string">'m'</span>,</span><br><span class="line">        ])</span><br><span class="line">        -&gt;requirements([</span><br><span class="line">            <span class="string">'subdomain'</span> =&gt; <span class="string">'m|mobile'</span>,</span><br><span class="line">        ])</span><br><span class="line">    ;</span><br><span class="line">    $routes-&gt;add(<span class="string">'homepage'</span>, <span class="string">'/'</span>)</span><br><span class="line">        -&gt;controller([MainController::class, <span class="string">'homepage'</span>])</span><br><span class="line">    ;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>在上面这些例子中，<code>subdomain</code> 参数定义了一个默认值，因为如果不这样做，你每次用这些路由生成 URL 都需要包含一个域名。</p>
<blockquote>
<p>你也可以在引入路由组的时设置 <code>host</code> 选项，从而使所有的路由都要求提供限定的主机名。</p>
</blockquote>
<blockquote>
<p>当使用子域名路由时，如果是在进行<a href="https://symfony.com/doc/current/testing.html" target="_blank" rel="noopener">功能测试</a>，你就必须设置主机的 HTTP 头，否则路由是不会被匹配到的。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$crawler = $client-&gt;request(</span><br><span class="line">   <span class="string">'GET'</span>,</span><br><span class="line">   <span class="string">'/'</span>,</span><br><span class="line">   [],</span><br><span class="line">   [],</span><br><span class="line">   [<span class="string">'HTTP_HOST'</span> =&gt; <span class="string">'m.example.com'</span>]</span><br><span class="line">   <span class="comment">// or get the value from some container parameter:</span></span><br><span class="line">   <span class="comment">// ['HTTP_HOST' =&gt; 'm.' . $client-&gt;getContainer()-&gt;getParameter('domain')]</span></span><br><span class="line">); </span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="国际化路由（i18n）"><a href="#国际化路由（i18n）" class="headerlink" title="国际化路由（i18n）"></a><span id="localized_routes">国际化路由（i18n）</span></h3><p>如果我们的应用程序中使用了多语言，每一个路由都为每个<a href="https://symfony.com/doc/current/translation/locale.html" target="_blank" rel="noopener">翻译区域</a>定义一个不同的 URL。这个功能避免了重复的路由，也减少了潜在的错误：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Controller/CompanyController.php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Bundle</span>\<span class="title">FrameworkBundle</span>\<span class="title">Controller</span>\<span class="title">AbstractController</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Annotation</span>\<span class="title">Route</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CompanyController</span> <span class="keyword">extends</span> <span class="title">AbstractController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Route</span>(&#123;</span></span><br><span class="line"><span class="comment">     *     "en": "/about-us",</span></span><br><span class="line"><span class="comment">     *     "nl": "/over-ons"</span></span><br><span class="line"><span class="comment">     * &#125;, name="about_us")</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">about</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/routes.yaml</span></span><br><span class="line"><span class="attr">about_us:</span></span><br><span class="line">    <span class="attr">path:</span></span><br><span class="line">        <span class="attr">en:</span> <span class="string">/about-us</span></span><br><span class="line">        <span class="attr">nl:</span> <span class="string">/over-ons</span></span><br><span class="line">    <span class="attr">controller:</span> <span class="string">App\Controller\CompanyController::about</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- config/routes.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">routes</span> <span class="attr">xmlns</span>=<span class="string">"http://symfony.com/schema/routing"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://symfony.com/schema/routing</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://symfony.com/schema/routing/routing-1.0.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">route</span> <span class="attr">id</span>=<span class="string">"about_us"</span> <span class="attr">controller</span>=<span class="string">"App\Controller\CompanyController::about"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span> <span class="attr">locale</span>=<span class="string">"en"</span>&gt;</span>/about-us<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span> <span class="attr">locale</span>=<span class="string">"nl"</span>&gt;</span>/over-ons<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">route</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">routes</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/routes.php</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Controller</span>\<span class="title">CompanyController</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Loader</span>\<span class="title">Configurator</span>\<span class="title">RoutingConfigurator</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">(RoutingConfigurator $routes)</span> </span>&#123;</span><br><span class="line">    $routes-&gt;add(<span class="string">'about_us'</span>, [</span><br><span class="line">        <span class="string">'en'</span> =&gt; <span class="string">'/about-us'</span>,</span><br><span class="line">        <span class="string">'nl'</span> =&gt; <span class="string">'/over-ons'</span>,</span><br><span class="line">    ])</span><br><span class="line">        -&gt;controller([CompanyController::class, <span class="string">'about'</span>])</span><br><span class="line">    ;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>当本地化路由被匹配到时，Symfony 会在请求进入期间自动使用同样的区域设置。</p>
<blockquote>
<p>当应用程序使用完整的 “语言 + 领地” 区域设置（例如 <code>fr_FR</code>, <code>fr_BE</code>），如果所有相关区域设置的 URL 都是相同的，路由将会只使用语言部分（例如 <code>fr</code>）来阻止相同的 URL 出现重复。</p>
</blockquote>
<p>国际化应用程序的一个常见要求，是使用区域设置为所有的路由添加前缀。这可以通过为每个区域设置定义不同的前缀（如果你愿意的话，可以为默认区域设置设置一个空前缀）：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/routes/annotations.yaml</span></span><br><span class="line"><span class="attr">controllers:</span></span><br><span class="line">    <span class="attr">resource:</span> <span class="string">'../../src/Controller/'</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">annotation</span></span><br><span class="line">    <span class="attr">prefix:</span></span><br><span class="line">        <span class="attr">en:</span> <span class="string">''</span> <span class="comment"># don't prefix URLs for English, the default locale</span></span><br><span class="line">        <span class="attr">nl:</span> <span class="string">'/nl'</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- config/routes/annotations.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">routes</span> <span class="attr">xmlns</span>=<span class="string">"http://symfony.com/schema/routing"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://symfony.com/schema/routing</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://symfony.com/schema/routing/routing-1.0.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">"../../src/Controller/"</span> <span class="attr">type</span>=<span class="string">"annotation"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- don't prefix URLs for English, the default locale --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">prefix</span> <span class="attr">locale</span>=<span class="string">"en"</span>&gt;</span><span class="tag">&lt;/<span class="name">prefix</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">prefix</span> <span class="attr">locale</span>=<span class="string">"nl"</span>&gt;</span>/nl<span class="tag">&lt;/<span class="name">prefix</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">import</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">routes</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/routes/annotations.php</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Loader</span>\<span class="title">Configurator</span>\<span class="title">RoutingConfigurator</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">(RoutingConfigurator $routes)</span> </span>&#123;</span><br><span class="line">    $routes-&gt;import(<span class="string">'../../src/Controller/'</span>, <span class="string">'annotation'</span>)</span><br><span class="line">        -&gt;prefix([</span><br><span class="line">            <span class="comment">// don't prefix URLs for English, the default locale</span></span><br><span class="line">            <span class="string">'en'</span> =&gt; <span class="string">''</span>,</span><br><span class="line">            <span class="string">'nl'</span> =&gt; <span class="string">'/nl'</span></span><br><span class="line">        ])</span><br><span class="line">    ;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="无状态路由"><a href="#无状态路由" class="headerlink" title="无状态路由"></a><span id="stateless_routes">无状态路由</span></h3><blockquote>
<p><code>stateless</code> 选项在 Symfony 5.1 中首次被引入。</p>
</blockquote>
<p>某些情况下，当一个 HTTP 响应需要被缓存时，确保这件事发生是非常重要的。然而在请求过程中，无论 session 是何时开启的，Symfony 都会将响应转换为一个私有的不可缓存的响应。</p>
<p>获取更多细节，详见<a href="https://symfony.com/doc/current/http_cache.html" target="_blank" rel="noopener">HTTP Cache</a>。</p>
<p>路由可以配置一个 <code>stateless</code> 布尔值选项， 来声明路由匹配到的一个请求中 session 是不可用的。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Controller/MainController.php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Bundle</span>\<span class="title">FrameworkBundle</span>\<span class="title">Controller</span>\<span class="title">AbstractController</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Annotation</span>\<span class="title">Route</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainController</span> <span class="keyword">extends</span> <span class="title">AbstractController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Route</span>("/", name="homepage", stateless=true)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">homepage</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/routes.yaml</span></span><br><span class="line"><span class="attr">homepage:</span></span><br><span class="line">    <span class="attr">controller:</span> <span class="string">App\Controller\MainController::homepage</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">    <span class="attr">stateless:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- config/routes.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">routes</span> <span class="attr">xmlns</span>=<span class="string">"http://symfony.com/schema/routing"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://symfony.com/schema/routing</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://symfony.com/schema/routing/routing-1.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">route</span> <span class="attr">id</span>=<span class="string">"homepage"</span> <span class="attr">controller</span>=<span class="string">"App\Controller\MainController::homepage"</span> <span class="attr">path</span>=<span class="string">"/"</span> <span class="attr">stateless</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">routes</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/routes.php</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Controller</span>\<span class="title">MainController</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Bundle</span>\<span class="title">FrameworkBundle</span>\<span class="title">Routing</span>\<span class="title">Loader</span>\<span class="title">Configurator</span>\<span class="title">RoutingConfigurator</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">(RoutingConfigurator $routes)</span> </span>&#123;</span><br><span class="line">    $routes-&gt;add(<span class="string">'homepage'</span>, <span class="string">'/'</span>)</span><br><span class="line">        -&gt;controller([MainController::class, <span class="string">'homepage'</span>])</span><br><span class="line">        -&gt;stateless()</span><br><span class="line">    ;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>现在，如果 session 被使用了，应用程序会基于你的 <code>kernel.debug</code> 参数配置：* <code>enable</code>：将会抛出一个 <code>Symfony\Component\HttpKernel\Exception\UnexpectedSessionUsageException</code> 异常，* <code>disabled</code> 将会记录一个警告</p>
<p>它将会帮助你更好的理解并更容易修复应用程序中不期待的行为。</p>
<h3 id="生成-URL"><a href="#生成-URL" class="headerlink" title="生成 URL"></a><span id="generating_urls">生成 URL</span></h3><p>路由系统是双向的：1）它们将 URL 与控制器关联（如前几节所述）;2）它们为给定路由生成 URL。通过从路由生成 URL，可以允许你不用在 HTML 模板中手动写入 <code>&lt;a href=&quot;...&quot;&gt;</code>这样的代码。此外，如果某些路由的 URL 发生更改，你只需更新路由配置，所有链接都将更新。</p>
<p>为了生成一个路由，你需要指定路由的名称（例如 <code>blog_show</code>）以及被路由定义的参数值（例如 <code>slug = my-blog-post</code>）。</p>
<p>因此，每个路由都需要有一个内部名称，并且该名称在应用程序中必须是唯一的。如果你没有使用 <code>name</code> 选项显式地设置路由名称，Symfony 将基于控制器和动作生成自动的名称。</p>
<h4 id="在控制器中生成-URL"><a href="#在控制器中生成-URL" class="headerlink" title="在控制器中生成 URL"></a><span id="generating_urls_in_controllers">在控制器中生成 URL</span></h4><p>如果你的控制器继承自 <a href="https://symfony.com/doc/current/controller.html#the-base-controller-class-services" target="_blank" rel="noopener">AbstractController</a>，使用 <code>generateUrl()</code> 辅助方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Controller/BlogController.php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Bundle</span>\<span class="title">FrameworkBundle</span>\<span class="title">Controller</span>\<span class="title">AbstractController</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Annotation</span>\<span class="title">Route</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Generator</span>\<span class="title">UrlGeneratorInterface</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BlogController</span> <span class="keyword">extends</span> <span class="title">AbstractController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Route</span>("/blog", name="blog_list")</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">list</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 生成一个不携带路由参数的 URL</span></span><br><span class="line">        $signUpPage = <span class="keyword">$this</span>-&gt;generateUrl(<span class="string">'sign_up'</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 生成一个携带路由参数的 URL</span></span><br><span class="line">        $userProfilePage = <span class="keyword">$this</span>-&gt;generateUrl(<span class="string">'user_profile'</span>, [</span><br><span class="line">            <span class="string">'username'</span> =&gt; $user-&gt;getUsername(),</span><br><span class="line">        ]);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 默认生成的URL都是 "绝对路径" 。 传递第三个可选</span></span><br><span class="line">        <span class="comment">// 参数来生成不同的 URL (例如一个 "absolute URL")</span></span><br><span class="line">        $signUpPage = <span class="keyword">$this</span>-&gt;generateUrl(<span class="string">'sign_up'</span>, [], UrlGeneratorInterface::ABSOLUTE_URL);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 当一个路由是本地化的时， Symfony 默认使用当前请求的的区域设置</span></span><br><span class="line">        <span class="comment">// 如果你想显式的设置区域，需要传一个不同的 '_locale' 值</span></span><br><span class="line">        $signUpPageInDutch = <span class="keyword">$this</span>-&gt;generateUrl(<span class="string">'sign_up'</span>, [<span class="string">'_locale'</span> =&gt; <span class="string">'nl'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果你向 <code>generateUrl()</code> 方法传递了一些不属于路由定义的参数，这些参数会在生成的 URL 中作为查询字符串存在：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;generateUrl(<span class="string">'blog'</span>, [<span class="string">'page'</span> =&gt; <span class="number">2</span>, <span class="string">'category'</span> =&gt; <span class="string">'Symfony'</span>]);</span><br><span class="line"><span class="comment">// 'blog' 路由只定义了 'page' 参数； 生成的 URL 为：</span></span><br><span class="line"><span class="comment">// /blog/2?category=Symfony </span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>如果你的控制器没有继承自 <code>AbstractController</code>，你需要在<a href="https://symfony.com/doc/current/controller.html#controller-accessing-services" target="_blank" rel="noopener">控制器中获取服务</a>，并按照下一节的说明进行操作。</p>
<h4 id="在服务中生成-URL"><a href="#在服务中生成-URL" class="headerlink" title="在服务中生成 URL"></a><span id="generating_urls_in_sevices">在服务中生成 URL</span></h4><p>在你自己的服务中注入 <code>router</code> Symfony 服务就可以使用它的 <code>generate()</code> 方法。当使用<a href="https://symfony.com/doc/current/service_container/autowiring.html" target="_blank" rel="noopener">服务重写</a>时，你只需要在服务的构造方法中添加一个参数，并且使用 <code>Symfony\Component\Routing\Generator\UrlGeneratorInterface</code> 作为参数的类型约束：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Service/SomeService.php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Service</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Generator</span>\<span class="title">UrlGeneratorInterface</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeService</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $router;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(UrlGeneratorInterface $router)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;router = $router;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">someMethod</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 生成一个不携带路由参数的 URL</span></span><br><span class="line">        $signUpPage = <span class="keyword">$this</span>-&gt;router-&gt;generate(<span class="string">'sign_up'</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 生成一个携带路由参数的 URL</span></span><br><span class="line">        $userProfilePage = <span class="keyword">$this</span>-&gt;router-&gt;generate(<span class="string">'user_profile'</span>, [</span><br><span class="line">            <span class="string">'username'</span> =&gt; $user-&gt;getUsername(),</span><br><span class="line">        ]);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 默认生成的URL都是 "绝对路径" 。 传递第三个可选</span></span><br><span class="line">        <span class="comment">// 参数来生成不同的 URL (例如一个 "absolute URL")</span></span><br><span class="line">        $signUpPage = <span class="keyword">$this</span>-&gt;router-&gt;generate(<span class="string">'sign_up'</span>, [], UrlGeneratorInterface::ABSOLUTE_URL);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 当一个路由是本地化的时， Symfony 默认使用当前请求的的区域设置</span></span><br><span class="line">        <span class="comment">// 如果你想显式的设置区域，需要传一个不同的 '_locale' 值</span></span><br><span class="line">        $signUpPageInDutch = <span class="keyword">$this</span>-&gt;router-&gt;generate(<span class="string">'sign_up'</span>, [<span class="string">'_locale'</span> =&gt; <span class="string">'nl'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="在模板中生成-URL"><a href="#在模板中生成-URL" class="headerlink" title="在模板中生成 URL"></a><span id="generating_urls_in_templates">在模板中生成 URL</span></h4><p>在 Symfony 模板的主文章中，阅读关于<a href="https://symfony.com/doc/current/templates.html#templates-link-to-pages" target="_blank" rel="noopener">在页面间创建链接</a>章节。</p>
<h4 id="在-JavaScript-中生成-URL"><a href="#在-JavaScript-中生成-URL" class="headerlink" title="在 JavaScript 中生成 URL"></a><span id="generating_urls_in_templates">在 JavaScript 中生成 URL</span></h4><p>如果你的 JavaScript 代码包含在一个 Twig 模板中，你可以使用 <code>path()</code> 和 <code>url()</code> 这两个 Twig 函数来生成 URL 已经将它们存储到 JavaScript 变量中。<code>escape()</code> 函数需要避免任何<em>非JavaScript安全</em>的值。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">    <span class="keyword">const</span> route = <span class="string">"&#123;&#123; path('blog_show', &#123;slug: 'my-blog-post'&#125;)|escape('js') &#125;&#125;"</span>;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果你想动态的生成 URL 或是你正在使用纯 JavaScript 代码，这个方案是无效的。在这种情况下，你可以考虑使用<a href="https://github.com/FriendsOfSymfony/FOSJsRoutingBundle" target="_blank" rel="noopener">FOSJsRoutingBundle</a>。</p>
<h4 id="在命令行中生成-URL"><a href="#在命令行中生成-URL" class="headerlink" title="在命令行中生成 URL"></a><span id="generating_urls_in_commands">在命令行中生成 URL</span></h4><p>在命令行中生成 URL 的工作与<a href="#generating_urls_in_sevices">在服务中生成 URL</a>的方式类似。唯一的不同在于命令行中不能执行 HTTP 的上下文。因此，如果你想生成绝对 URL，你需要使用 <code>http://localhost/</code> 作为主机名来代替真实主机名。</p>
<p>解决方案就是配置 <code>default_uri</code> 选项，来定义被命令行生成 URL 时使用的 “request context”：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/packages/routing.yaml</span></span><br><span class="line"><span class="attr">framework:</span></span><br><span class="line">    <span class="attr">router:</span></span><br><span class="line">        <span class="comment"># ...</span></span><br><span class="line">        <span class="attr">default_uri:</span> <span class="string">'https://example.org/my/path/'</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- config/packages/routing.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">container</span> <span class="attr">xmlns</span>=<span class="string">"http://symfony.com/schema/dic/services"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:framework</span>=<span class="string">"http://symfony.com/schema/dic/symfony"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://symfony.com/schema/dic/services</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://symfony.com/schema/dic/services/services-1.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://symfony.com/schema/dic/symfony</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://symfony.com/schema/dic/symfony/symfony-1.0.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">framework:config</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">framework:router</span> <span class="attr">default-uri</span>=<span class="string">"https://example.org/my/path/"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- ... --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">framework:router</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">framework:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">container</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/packages/routing.php</span></span><br><span class="line">$container-&gt;loadFromExtension(<span class="string">'framework'</span>, [</span><br><span class="line">    <span class="string">'router'</span> =&gt; [</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="string">'default_uri'</span> =&gt; <span class="string">"https://example.org/my/path/"</span>,</span><br><span class="line">    ],</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>default_uri</code> 选项在 Symfony 5.1 中首次被引入。</p>
</blockquote>
<p>现在你可以在你的命令行中生成 URL，以获得你所期待的结果。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Command/SomeCommand.php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Command</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Console</span>\<span class="title">Command</span>\<span class="title">Command</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Console</span>\<span class="title">Input</span>\<span class="title">InputInterface</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Console</span>\<span class="title">Output</span>\<span class="title">OutputInterface</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Generator</span>\<span class="title">UrlGeneratorInterface</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">RouterInterface</span>;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeCommand</span> <span class="keyword">extends</span> <span class="title">Command</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $router;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(RouterInterface $router)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">parent</span>::__construct();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;router = $router;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">execute</span><span class="params">(InputInterface $input, OutputInterface $output)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 生成一个不携带路由参数的 URL</span></span><br><span class="line">        $signUpPage = <span class="keyword">$this</span>-&gt;router-&gt;generate(<span class="string">'sign_up'</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 生成一个携带路由参数的 URL</span></span><br><span class="line">        $userProfilePage = <span class="keyword">$this</span>-&gt;router-&gt;generate(<span class="string">'user_profile'</span>, [</span><br><span class="line">            <span class="string">'username'</span> =&gt; $user-&gt;getUsername(),</span><br><span class="line">        ]);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 默认生成的URL都是 "绝对路径" 。 传递第三个可选</span></span><br><span class="line">        <span class="comment">// 参数来生成不同的 URL (例如一个 "absolute URL")</span></span><br><span class="line">        $signUpPage = <span class="keyword">$this</span>-&gt;router-&gt;generate(<span class="string">'sign_up'</span>, [], UrlGeneratorInterface::ABSOLUTE_URL);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 当一个路由是本地化的时， Symfony 默认使用当前请求的的区域设置</span></span><br><span class="line">        <span class="comment">// 如果你想显式的设置区域，需要传一个不同的 '_locale' 值</span></span><br><span class="line">        $signUpPageInDutch = <span class="keyword">$this</span>-&gt;router-&gt;generate(<span class="string">'sign_up'</span>, [<span class="string">'_locale'</span> =&gt; <span class="string">'nl'</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>默认情况下，网络资产生成的 URL 使用同样的 <code>default_uri</code> 值，不过你也可以使用 <code>asset.request_context.base_path</code> 和 <code>asset.request_context.secure</code> 这两个容器参数来改变它。</p>
</blockquote>
<h4 id="检查一个路由是否存在"><a href="#检查一个路由是否存在" class="headerlink" title="检查一个路由是否存在"></a><span id="checking_if_a_route_exists">检查一个路由是否存在</span></h4><p>在高度动态化的应用程序中，在使用一个路由生成 URL 前，检查它是否存在是很必要的。在这种情况下，不要使用<a href="https://github.com/symfony/symfony/blob/5.1/src/Symfony/Component/Routing/Router.php" target="_blank" rel="noopener">getRouteCollection()</a>方法，因为它将再次创建路由缓存并拖慢应用程序。</p>
<p>取而代之，你可以尝试生成 URL 并在路由不存在的时候捕捉抛出的 <code>Symfony\Component\Routing\Exception\RouteNotFoundException</code>。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Exception</span>\<span class="title">RouteNotFoundException</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    $url = <span class="keyword">$this</span>-&gt;router-&gt;generate($routeName, $routeParameters);</span><br><span class="line">&#125; <span class="keyword">catch</span> (RouteNotFoundException $e) &#123;</span><br><span class="line">    <span class="comment">// 路由未被定义...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="在生成的-URL-中强制使用-HTTPS"><a href="#在生成的-URL-中强制使用-HTTPS" class="headerlink" title="在生成的 URL 中强制使用 HTTPS"></a><span id="forcing_https_on_generated_urls">在生成的 URL 中强制使用 HTTPS</span></h4><p>默认情况下，生成的 URL 使用当前请求同样的 HTTP 协议。在控制台的命令行中，没有 HTTP 请求，URL 就默认使用 <code>http</code>。你可以改变每一个命令（通过路由的 <code>getContext()</code> 方法），或者使用全局配置参数：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/services.yaml</span></span><br><span class="line"><span class="attr">parameters:</span></span><br><span class="line">    <span class="attr">router.request_context.scheme:</span> <span class="string">'https'</span></span><br><span class="line">    <span class="attr">asset.request_context.secure:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- config/services.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">container</span> <span class="attr">xmlns</span>=<span class="string">"http://symfony.com/schema/dic/services"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://symfony.com/schema/dic/services</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://symfony.com/schema/dic/services/services-1.0.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">parameters</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parameter</span> <span class="attr">key</span>=<span class="string">"router.request_context.scheme"</span>&gt;</span>https<span class="tag">&lt;/<span class="name">parameter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">parameter</span> <span class="attr">key</span>=<span class="string">"asset.request_context.secure"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">parameter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parameters</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">container</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/services.php</span></span><br><span class="line">$container-&gt;setParameter(<span class="string">'router.request_context.scheme'</span>, <span class="string">'https'</span>);</span><br><span class="line">$container-&gt;setParameter(<span class="string">'asset.request_context.secure'</span>, <span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>

<p>控制台命令行之外的地方，使用 <code>schemes</code> 选项来显式地定义每个路由的协议：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/Controller/SecurityController.php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Bundle</span>\<span class="title">FrameworkBundle</span>\<span class="title">Controller</span>\<span class="title">AbstractController</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Annotation</span>\<span class="title">Route</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SecurityController</span> <span class="keyword">extends</span> <span class="title">AbstractController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Route</span>("/login", name="login", schemes=&#123;"https"&#125;)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/routes.yaml</span></span><br><span class="line"><span class="attr">login:</span></span><br><span class="line">    <span class="attr">path:</span>       <span class="string">/login</span></span><br><span class="line">    <span class="attr">controller:</span> <span class="string">App\Controller\SecurityController::login</span></span><br><span class="line">    <span class="attr">schemes:</span>    <span class="string">[https]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- config/routes.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">routes</span> <span class="attr">xmlns</span>=<span class="string">"http://symfony.com/schema/routing"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://symfony.com/schema/routing https://symfony.com/schema/routing/routing-1.0.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">route</span> <span class="attr">id</span>=<span class="string">"login"</span> <span class="attr">path</span>=<span class="string">"/login"</span> <span class="attr">schemes</span>=<span class="string">"https"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">controller</span>=<span class="string">"App\Controller\SecurityController::login"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">routes</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/routes.php</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Controller</span>\<span class="title">SecurityController</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Loader</span>\<span class="title">Configurator</span>\<span class="title">RoutingConfigurator</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">(RoutingConfigurator $routes)</span> </span>&#123;</span><br><span class="line">    $routes-&gt;add(<span class="string">'login'</span>, <span class="string">'/login'</span>)</span><br><span class="line">        -&gt;controller([SecurityController::class, <span class="string">'login'</span>])</span><br><span class="line">        -&gt;schemes([<span class="string">'https'</span>])</span><br><span class="line">    ;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><code>login</code> 路由生成的 URL 会一直使用 HTTPS。这意味着当使用 <code>path()</code> 这个 Twig 模板函数生成 URL，如果原始请求的 HTTP 协议同路由使用的协议不同，你可能会获取到一个绝对路径的 URL，而不是一个相对路径的 URL：</p>
<figure class="highlight twig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&#123;# 如果当前协议是 HTTPS, 生成了一个相对 URL: /login #&#125;</span></span><br><span class="line"><span class="template-variable">&#123;&#123; path('login') &#125;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&#123;# 如果当前协议是 HTTP, 生成了一个绝对 URL 就会改变</span></span><br><span class="line"><span class="comment">   协议：https://example.com/login #&#125;</span></span><br><span class="line"><span class="template-variable">&#123;&#123; path('login') &#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>协议条件对于访问的请求是强制性的。如果你试图使用 HTTP 的协议访问 <code>/login</code> URL，你将会被自动地重定向到同样的 URL，但是使用了 HTTPS 协议。</p>
<p>如果你想强制一组路由使用 HTTPS，你可以定义在引入路由的时候的定义默认的协议。下面的例子就展示了如何让所有使用 annotations 方式定义的路由，强制使用 HTTPS：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># config/routes/annotations.yaml</span></span><br><span class="line"><span class="attr">controllers:</span></span><br><span class="line">    <span class="attr">resource:</span> <span class="string">'../../src/Controller/'</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">annotation</span></span><br><span class="line">    <span class="attr">defaults:</span></span><br><span class="line">        <span class="attr">schemes:</span> <span class="string">[https]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- config/routes/annotations.xml --&gt;</span></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">routes</span> <span class="attr">xmlns</span>=<span class="string">"http://symfony.com/schema/routing"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://symfony.com/schema/routing</span></span></span><br><span class="line"><span class="tag"><span class="string">        https://symfony.com/schema/routing/routing-1.0.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">"../../src/Controller/"</span> <span class="attr">type</span>=<span class="string">"annotation"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">default</span> <span class="attr">key</span>=<span class="string">"schemes"</span>&gt;</span>HTTPS<span class="tag">&lt;/<span class="name">default</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">import</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">routes</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/routes/annotations.php</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Loader</span>\<span class="title">Configurator</span>\<span class="title">RoutingConfigurator</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">(RoutingConfigurator $routes)</span> </span>&#123;</span><br><span class="line">    $routes-&gt;import(<span class="string">'../../src/Controller/'</span>, <span class="string">'annotation'</span>)</span><br><span class="line">        -&gt;schemes([<span class="string">'https'</span>])</span><br><span class="line">    ;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>安全组件提供了另一种通过 <code>requires_channel</code> 设置来<a href="https://symfony.com/doc/current/security/force_https.html" target="_blank" rel="noopener">强制使用 HTTP 或 HTTPS</a> 的方案。</p>
</blockquote>
<h3 id="故障排除"><a href="#故障排除" class="headerlink" title="故障排除"></a><span id="troubleshooting">故障排除</span></h3><p>这是一些你在使用路由功能的工作过程中可能会遇到的常见错误：</p>
<blockquote>
<p>Controller “App\Controller\BlogController::show()” requires that you provide a value for the “$slug” argument.</p>
</blockquote>
<p>这经常发生在当你的控制器方法中含有一个参数时（例如 <code>$slug</code>）：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span><span class="params">($slug)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是你的路由路径中<em>没有</em>包含一个 <code>{slug}</code> 参数（例如它可能是 <code>/blog/show</code>）。在你的路由路径上添加一个 <code>{slug}</code>：<code>/blog/show/{slug}</code> 或者给参数一个默认值（例如 <code>$slug = null</code>）：</p>
<blockquote>
<p>Some mandatory parameters are missing (“slug”) to generate a URL for route “blog_show”.</p>
</blockquote>
<p>这句话的意思是你正尝试给 <code>blog_show</code> 路由生成一个 URL，但是你<em>没有</em>传一个 <code>slug</code> 值（这个值是必须的，因为它在路由路径上有一个 <code>{slug}</code> 参数）。要解决这个问题，在生成路由的时候传递一个 <code>slug</code> 值：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;generateUrl(<span class="string">'blog_show'</span>, [<span class="string">'slug'</span> =&gt; <span class="string">'slug-value'</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 或者，在 Twig 中</span></span><br><span class="line"><span class="comment">// &#123;&#123; path('blog_show', &#123;slug: 'slug-value'&#125;) &#125;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="学习更多有关路由的知识"><a href="#学习更多有关路由的知识" class="headerlink" title="学习更多有关路由的知识"></a><span id="learn_more_about_routing">学习更多有关路由的知识</span></h3><ul>
<li><a href="https://symfony.com/doc/current/routing/custom_route_loader.html" target="_blank" rel="noopener">如何创建一个定制的路由加载器</a></li>
<li><a href="https://symfony.com/doc/current/routing/routing_from_database.html" target="_blank" rel="noopener">如何从数据库中查找路由：Symfony CMF 动态路由</a></li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/PHP/" rel="tag"># PHP</a>
              <a href="/tags/Symfony/" rel="tag"># Symfony</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/06/13/Symfony-5-%E8%AF%95%E7%94%A8/" rel="prev" title="Symfony 5 试用">
      <i class="fa fa-chevron-left"></i> Symfony 5 试用
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/08/29/Symfony-5-%E5%9F%BA%E7%A1%80%E4%B9%8B%E6%8E%A7%E5%88%B6%E5%99%A8/" rel="next" title="Symfony 5 基础之控制器">
      Symfony 5 基础之控制器 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#什么是路由"><span class="nav-number">1.</span> <span class="nav-text">什么是路由</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建路由"><span class="nav-number">2.</span> <span class="nav-text">创建路由</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Annotations-方式创建路由"><span class="nav-number">2.1.</span> <span class="nav-text">Annotations 方式创建路由</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#以文件（YAML-XML-PHP）的方式创建路由"><span class="nav-number">2.2.</span> <span class="nav-text">以文件（YAML,XML,PHP）的方式创建路由</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#匹配HTTP方法"><span class="nav-number">2.3.</span> <span class="nav-text">匹配HTTP方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#匹配表达式"><span class="nav-number">2.4.</span> <span class="nav-text">匹配表达式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#调试路由"><span class="nav-number">2.5.</span> <span class="nav-text">调试路由</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#路由参数"><span class="nav-number">3.</span> <span class="nav-text">路由参数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#参数校验"><span class="nav-number">3.1.</span> <span class="nav-text">参数校验</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#可选参数"><span class="nav-number">3.2.</span> <span class="nav-text">可选参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#优先级参数"><span class="nav-number">3.3.</span> <span class="nav-text">优先级参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#参数转换"><span class="nav-number">3.4.</span> <span class="nav-text">参数转换</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#特殊参数"><span class="nav-number">3.5.</span> <span class="nav-text">特殊参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#额外参数"><span class="nav-number">3.6.</span> <span class="nav-text">额外参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#路由参数中的斜线字符"><span class="nav-number">3.7.</span> <span class="nav-text">路由参数中的斜线字符</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#路由组和前缀"><span class="nav-number">4.</span> <span class="nav-text">路由组和前缀</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#获取路由名称和参数"><span class="nav-number">5.</span> <span class="nav-text">获取路由名称和参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#特殊路由"><span class="nav-number">6.</span> <span class="nav-text">特殊路由</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#直接从一个路由渲染模板"><span class="nav-number">6.1.</span> <span class="nav-text">直接从一个路由渲染模板</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#直接从一个路由重定向到-URL-和路由"><span class="nav-number">6.2.</span> <span class="nav-text">直接从一个路由重定向到 URL 和路由</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#使用拖尾斜杠重定向"><span class="nav-number">6.3.</span> <span class="nav-text">使用拖尾斜杠重定向</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#子域名路由"><span class="nav-number">7.</span> <span class="nav-text">子域名路由</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#国际化路由（i18n）"><span class="nav-number">8.</span> <span class="nav-text">国际化路由（i18n）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#无状态路由"><span class="nav-number">9.</span> <span class="nav-text">无状态路由</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#生成-URL"><span class="nav-number">10.</span> <span class="nav-text">生成 URL</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#在控制器中生成-URL"><span class="nav-number">10.1.</span> <span class="nav-text">在控制器中生成 URL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#在服务中生成-URL"><span class="nav-number">10.2.</span> <span class="nav-text">在服务中生成 URL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#在模板中生成-URL"><span class="nav-number">10.3.</span> <span class="nav-text">在模板中生成 URL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#在-JavaScript-中生成-URL"><span class="nav-number">10.4.</span> <span class="nav-text">在 JavaScript 中生成 URL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#在命令行中生成-URL"><span class="nav-number">10.5.</span> <span class="nav-text">在命令行中生成 URL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#检查一个路由是否存在"><span class="nav-number">10.6.</span> <span class="nav-text">检查一个路由是否存在</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#在生成的-URL-中强制使用-HTTPS"><span class="nav-number">10.7.</span> <span class="nav-text">在生成的 URL 中强制使用 HTTPS</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#故障排除"><span class="nav-number">11.</span> <span class="nav-text">故障排除</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#学习更多有关路由的知识"><span class="nav-number">12.</span> <span class="nav-text">学习更多有关路由的知识</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Andy Zhang"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Andy Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">5</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Andy Zhang</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.7.0
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
